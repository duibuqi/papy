
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pa &#8212; papy 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pa</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Power Analysis (Python) tool</span>
<span class="sd">Developed by Dr. Goncalo Correia and Dr Jianliang Gao</span>
<span class="sd">Imperial College London</span>
<span class="sd">2016</span>

<span class="sd">simple usage: python pa.py TutorialData.csv 8</span>

<span class="sd">         &quot;TutorialData.csv&quot; is input test data set, can be replaced by actual data set name.</span>

<span class="sd">         &quot;8&quot; means the first 8 variables, which can be a range, e.g., 8-16</span>

<span class="sd">full usage: python pa.py TutorialData.csv 2-9 0:100:500 0.05:0.05:0.7 20 0 4</span>

<span class="sd">        &quot;0:100:500&quot; (default value) means the range of sample sizes from 0 to 500 (not inclusive) with interval of 100.</span>

<span class="sd">        &quot;0.05:0.05:0.7&quot; (default value) means the range of effect sizes from 0.05 to 0.7 (not inclusive) with interval of 0.05.</span>

<span class="sd">        &quot;20&quot; is an integer number of repeats. Default value is 10.</span>

<span class="sd">        &quot;0&quot; is the default input for working for classification only. Please choose 1 to work on regression only or 2 to work on both.</span>

<span class="sd">        &quot;4&quot; is an integer number as number of CPU cores to use. By default is to use all available cores.</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">csv</span><span class="o">,</span> <span class="nn">inspect</span><span class="o">,</span> <span class="nn">dis</span><span class="o">,</span> <span class="nn">os.path</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">multiprocessing</span><span class="o">,</span> <span class="nn">getopt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">scistats</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">sm</span>  <span class="c1"># for linear regression</span>
<span class="kn">import</span> <span class="nn">shutil</span>  <span class="c1"># for creating zip files</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">fabs</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">exp</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>

<div class="viewcode-block" id="iSurfacePlot"><a class="viewcode-back" href="../pa.html#pa.iSurfacePlot">[docs]</a><span class="k">def</span> <span class="nf">iSurfacePlot</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">svfilename</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">correction</span><span class="p">,</span> <span class="n">samplsizes</span><span class="p">,</span><span class="n">sizeeff</span><span class="p">,</span>  <span class="n">nreps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is for plotting interactive 3D surface plot for mean of all variables.</span>


<span class="sd">    :param output: array for plotting.2D numpy array</span>
<span class="sd">    :type output: array</span>
<span class="sd">    :param svfilename: filename for saving the corresponding plot.</span>
<span class="sd">    :type svfilename: String</span>
<span class="sd">    :param variable: variable index nubmer. for plotting mean of all variables, as the size is 1, therefore use 1 as input parameter.</span>
<span class="sd">    :type variable: int</span>
<span class="sd">    :param metric: metric (confusion matrix, &#39;TP&#39;, &#39;TF&#39; etc) index nubmer. for plotting mean of all variables, as the size is 1, therefore use 1 as input parameter.</span>
<span class="sd">    :type metric: int</span>
<span class="sd">    :param correction: correction methods (no correction, Bonferroni, Benjamini-Hochberg, Benjamini-Yekutieli index nubmer. for plotting mean of all variables, as the size is 1, therefore use 1 as input parameter.</span>
<span class="sd">    :type correction: int</span>
<span class="sd">    :param samplsizes: sample size matrix, numpy array 1 x n</span>
<span class="sd">    :type samplsizes: array</span>
<span class="sd">    :param sizeeff: effect size matrix, numpy array 1 x n</span>
<span class="sd">    :type sizeeff:  array</span>
<span class="sd">    :param nreps: number of repeats</span>
<span class="sd">    :type nreps: int</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">plotly</span> <span class="k">as</span> <span class="nn">py</span>
    <span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
    <span class="n">MUtot</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">variable</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">correction</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">metric</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">NS</span><span class="p">,</span> <span class="n">NSE</span> <span class="o">=</span> <span class="n">MUtot</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1">##SIGMAtot = output[variable-1][correction-1][metric+5-1]</span>
    <span class="c1">##SIGMAlow=MUtot-1.96*SIGMAtot/np.sqrt(nreps)</span>
    <span class="c1">##SIGMAlow = np.array([[0 if x&lt;0 else x for x in y] for y in SIGMAlow])</span>

    <span class="c1">##plot</span>
    <span class="c1">##generate a 2D grid</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">samplsizes</span><span class="p">,</span> <span class="n">sizeeff</span><span class="p">)</span>

    <span class="n">zaxis_title</span> <span class="o">=</span> <span class="s1">&#39;True Positive Rate&#39;</span>
    <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;mean&#39;</span> <span class="ow">in</span> <span class="n">svfilename</span><span class="p">:</span>
            <span class="n">zaxis_title</span> <span class="o">=</span> <span class="s1">&#39;True Positive Rate&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;tp&#39;</span> <span class="ow">in</span> <span class="n">svfilename</span><span class="p">:</span>
                <span class="n">zaxis_title</span> <span class="o">=</span> <span class="s1">&#39;True Positive Rate&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;fp&#39;</span> <span class="ow">in</span> <span class="n">svfilename</span><span class="p">:</span>
                <span class="n">zaxis_title</span> <span class="o">=</span> <span class="s1">&#39;False Positive Rate&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;tn&#39;</span> <span class="ow">in</span> <span class="n">svfilename</span><span class="p">:</span>
                <span class="n">zaxis_title</span> <span class="o">=</span> <span class="s1">&#39;True Negative Rate&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;fn&#39;</span> <span class="ow">in</span> <span class="n">svfilename</span><span class="p">:</span>
                <span class="n">zaxis_title</span> <span class="o">=</span> <span class="s1">&#39;False Negative Rate&#39;</span>
    <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">zaxis_title</span> <span class="o">=</span> <span class="s1">&#39;False Positive Rate&#39;</span>
    <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">zaxis_title</span> <span class="o">=</span> <span class="s1">&#39;True Negative Rate&#39;</span>
    <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">zaxis_title</span> <span class="o">=</span> <span class="s1">&#39;False Negative Rate&#39;</span>
    <span class="n">camera</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">up</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">center</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">eye</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Statistical Power Analysis Resutls&#39;</span><span class="p">,</span>
        <span class="n">autosize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">768</span><span class="p">,</span>
        <span class="n">margin</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Margin</span><span class="p">(</span>
            <span class="n">l</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
            <span class="n">r</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
            <span class="n">b</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">t</span><span class="o">=</span><span class="mi">60</span>
        <span class="p">),</span>
        <span class="n">scene</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Sample Sizes&#39;</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Effect Sizes&#39;</span><span class="p">,</span>
                <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                <span class="n">tick0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">dtick</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Y</span><span class="p">)]</span>
            <span class="p">),</span>
            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="n">zaxis_title</span><span class="p">,</span>
                <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                <span class="n">tick0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">dtick</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">MUtot</span><span class="p">)]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">camera</span><span class="o">=</span><span class="n">camera</span><span class="p">))</span>
    <span class="n">py</span><span class="o">.</span><span class="n">offline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">svfilename</span><span class="p">,</span> <span class="n">auto_open</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
<span class="c1">##=======End of interactive SurfacePlot============</span>

<span class="c1">##====== Beginning of scatter plot for slices of surface plots===============</span>
<div class="viewcode-block" id="iSlicesPlot"><a class="viewcode-back" href="../pa.html#pa.iSlicesPlot">[docs]</a><span class="k">def</span> <span class="nf">iSlicesPlot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Error_y</span><span class="p">,</span> <span class="n">svfilename</span><span class="p">,</span> <span class="n">plot_title</span><span class="p">,</span> <span class="n">x_caption</span><span class="p">,</span> <span class="n">y_caption</span><span class="p">,</span> <span class="n">trace_label</span><span class="p">,</span> <span class="n">trace_num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For plotting slices from surface plots. Interactive plots with error bars.</span>


<span class="sd">    :param X: matrix for x-axis. either sample size or effect size. Use 1 x n numpy array.</span>
<span class="sd">    :type X: array</span>
<span class="sd">    :param Y: matrix of mean proportion of variables reach power&gt;threshold.</span>
<span class="sd">    :type Y: array</span>
<span class="sd">    :param Error_y: a matrix contains standard deviation of proportion of variables reach power&gt;threshold within the repeats.</span>
<span class="sd">    :type Error_y: array</span>
<span class="sd">    :param svfilename: filename for saving plots in the running folder.</span>
<span class="sd">    :type  svfilename: string</span>
<span class="sd">    :param plot_title: Title for the plot</span>
<span class="sd">    :type plot_title: String</span>
<span class="sd">    :param x_caption: Caption for x-axis</span>
<span class="sd">    :type x_caption: String</span>
<span class="sd">    :param y_caption: Caption for y-axis</span>
<span class="sd">    :type y_caption: String</span>
<span class="sd">    :param trace_label: for each trace to show relevant txt.</span>
<span class="sd">    :type trace_label: String</span>
<span class="sd">    :param trace_num: for trace label when mouse cursor moving along plot to show which line is which</span>
<span class="sd">    :type trace_num: array</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">plotly</span> <span class="k">as</span> <span class="nn">py</span>
    <span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>

    <span class="n">traces</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)):</span>
        <span class="n">trace_tmp</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">error_y</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span>
            <span class="n">array</span><span class="o">=</span><span class="n">Error_y</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">),</span>
                               <span class="n">name</span><span class="o">=</span><span class="n">trace_label</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trace_num</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ii</span><span class="p">])</span>
                               <span class="p">)</span>
        <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trace_tmp</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">traces</span><span class="p">)</span>

    <span class="c1">##define other features of plots</span>

    <span class="c1">##dictionary of y_caption</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;tpn&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;Proportion&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(no correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;tpb&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;Proportion&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Bonferroni correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;tpbh&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;Proportion&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Benjamini-Hochberg correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;tpby&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;Proportion&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Benjamini-Yekutieli correction)&#39;</span>

    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;fpn&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;False Positive Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(no correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;fpb&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;False Positive Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Bonferroni correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;fpbh&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;False Positive Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Benjamini-Hochberg correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;fpby&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;False Positive Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Benjamini-Yekutieli correction)&#39;</span>

    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;tnn&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;True Negative Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(no correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;tnb&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;True Negative Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Bonferroni correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;tnbh&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;True Negative Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Benjamini-Hochberg correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;tnby&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;True Negative Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Benjamini-Yekutieli correction)&#39;</span>

    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;fnn&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;False Negative Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(no correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;fnb&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;False Negative Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Bonferroni correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;fnbh&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;False Negative Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Benjamini-Hochberg correction)&#39;</span>
    <span class="k">if</span> <span class="n">y_caption</span> <span class="o">==</span> <span class="s1">&#39;fnby&#39;</span><span class="p">:</span>
        <span class="n">y_caption</span> <span class="o">=</span> <span class="s1">&#39;False Negative Rate&#39;</span>
        <span class="n">plot_title</span> <span class="o">=</span> <span class="n">plot_title</span> <span class="o">+</span> <span class="s1">&#39;-(Benjamini-Yekutieli correction)&#39;</span>

    <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">plot_title</span><span class="p">,</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">x_caption</span><span class="p">,</span>
            <span class="n">titlefont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Courier New, monospace&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#7f7f7f&#39;</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">y_caption</span><span class="p">,</span>
            <span class="n">titlefont</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Courier New, monospace&#39;</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#7f7f7f&#39;</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
    <span class="n">py</span><span class="o">.</span><span class="n">offline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">svfilename</span><span class="p">,</span> <span class="n">auto_open</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
<span class="c1">##====== End of scatter plot for slices of surface plots===============</span>

<span class="c1">##====== Beginning of surface plot for power rate only===============</span>
<div class="viewcode-block" id="iSurfacePlotTPR"><a class="viewcode-back" href="../pa.html#pa.iSurfacePlotTPR">[docs]</a><span class="k">def</span> <span class="nf">iSurfacePlotTPR</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">svfilename</span><span class="p">,</span> <span class="n">correction</span><span class="p">,</span> <span class="n">samplsizes</span><span class="p">,</span> <span class="n">sizeeff</span><span class="p">,</span> <span class="n">nreps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This is for plotting interactive 3D surface plot for mean of proportion of all variables with power&gt;0.8 accross all repeats</span>


<span class="sd">    :param output: array for plotting.2D numpy array.</span>
<span class="sd">    :type output: array</span>
<span class="sd">    :param svfilename: filename for saving the corresponding plot.</span>
<span class="sd">    :type svfilename: String</span>
<span class="sd">    :param correction: correction methods (no correction, Bonferroni, Benjamini-Hochberg, Benjamini-Yekutieli index nubmer. for plotting mean of all variables, as the size is 1, therefore use 1 as input parameter.</span>
<span class="sd">    :type correction: int</span>
<span class="sd">    :param samplsizes: sample size matrix, numpy array 1 x n.</span>
<span class="sd">    :type samplsizes: array</span>
<span class="sd">    :param sizeeff: effect size matrix, numpy array 1 x n</span>
<span class="sd">    :type sizeeff:  array</span>
<span class="sd">    :param nreps: number of repeats</span>
<span class="sd">    :type nreps: int</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">plotly</span> <span class="k">as</span> <span class="nn">py</span>
    <span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
    <span class="n">MUtot</span> <span class="o">=</span> <span class="n">output</span>
    <span class="n">NS</span><span class="p">,</span> <span class="n">NSE</span> <span class="o">=</span> <span class="n">MUtot</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1">##plot</span>
    <span class="c1">##generate a 2D grid</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">samplsizes</span><span class="p">,</span> <span class="n">sizeeff</span><span class="p">)</span>

    <span class="c1">##define z axis title</span>
    <span class="n">zaxis_title</span> <span class="o">=</span> <span class="s1">&#39;Proportion&#39;</span>

    <span class="n">camera</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">up</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">center</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">eye</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8 -</span><span class="si">%s</span><span class="s1">, </span><span class="si">%d</span><span class="s1"> Repeats&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">correction</span><span class="p">,</span> <span class="n">nreps</span><span class="p">),</span>
        <span class="n">autosize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">768</span><span class="p">,</span>
        <span class="n">margin</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Margin</span><span class="p">(</span>
            <span class="n">l</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
            <span class="n">r</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
            <span class="n">b</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">t</span><span class="o">=</span><span class="mi">60</span>
        <span class="p">),</span>
        <span class="n">scene</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Sample Sizes&#39;</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Effect Sizes&#39;</span><span class="p">,</span>
                <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                <span class="n">tick0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">dtick</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Y</span><span class="p">)]</span>
            <span class="p">),</span>
            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="n">zaxis_title</span><span class="p">,</span>
                <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                <span class="n">tick0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">dtick</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">MUtot</span><span class="p">)]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">camera</span><span class="o">=</span><span class="n">camera</span><span class="p">))</span>
    <span class="n">py</span><span class="o">.</span><span class="n">offline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">svfilename</span><span class="p">,</span> <span class="n">auto_open</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
<span class="c1">##====== End of surface plot for power rate only===============</span>


<span class="c1">##=======Beginning of simulateLogNormal===================</span>
<div class="viewcode-block" id="simulateLogNormal"><a class="viewcode-back" href="../pa.html#pa.simulateLogNormal">[docs]</a><span class="k">def</span> <span class="nf">simulateLogNormal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">covType</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Using log(10) of input matrix to generate normally distributed multivariate matrix</span>

<span class="sd">    :param data: data matrix input</span>
<span class="sd">    :type data: array</span>
<span class="sd">    :param covType: Estimate a covariance matrix or Extract/construct a diagonal array from given variance.</span>
<span class="sd">    :type covType: String</span>
<span class="sd">    :param nSamples: number of simulated samples.</span>
<span class="sd">    :type nSamples: int</span>
<span class="sd">    :return: Return simulation data and correlation matrix</span>
<span class="sd">    :rtype: array array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">## find offset and offset the data. Why to do this?</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">offData</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">offset</span>

    <span class="c1">##log on the data array</span>
    <span class="n">logData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">offData</span><span class="p">)</span>

    <span class="n">meansLog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">logData</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">covType</span> <span class="o">==</span> <span class="s1">&#39;Estimate&#39;</span><span class="p">):</span>
        <span class="n">covLog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">logData</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">covType</span> <span class="o">==</span> <span class="s1">&#39;Diagonal&#39;</span><span class="p">):</span>
        <span class="n">varlogData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">logData</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># get variance of log data by each column</span>
        <span class="n">covLog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">varlogData</span><span class="p">)</span>  <span class="c1"># generate a matrix with diagonal of variance of log Data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unknown Covariance type&#39;</span><span class="p">)</span>

    <span class="n">simData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">meansLog</span><span class="p">),</span> <span class="n">covLog</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">)</span>

    <span class="n">simData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">simData</span><span class="p">)</span>
    <span class="n">simData</span> <span class="o">=</span> <span class="n">simData</span> <span class="o">-</span> <span class="n">offset</span>

    <span class="c1">##Set to 0 negative values</span>
    <span class="n">simData</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">simData</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">simData</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">):</span>
        <span class="n">simData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">simData</span><span class="p">)</span>
    <span class="n">corrMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">simData</span><span class="p">,</span><span class="n">rowvar</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># work out the correlation of matrix by columns, each column is a variable</span>

    <span class="k">return</span> <span class="n">simData</span><span class="p">,</span> <span class="n">corrMatrix</span></div>


<span class="c1">##=======End of simulateLogNormal===================</span>


<span class="c1">##=======Beginning of PCalc_Continuous====================</span>
<div class="viewcode-block" id="PCalc_Continuous"><a class="viewcode-back" href="../pa.html#pa.PCalc_Continuous">[docs]</a><span class="k">def</span> <span class="nf">PCalc_Continuous</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">EffectSizes</span><span class="p">,</span> <span class="n">SampSizes</span><span class="p">,</span> <span class="n">SignThreshold</span><span class="p">,</span> <span class="n">nSimSamp</span><span class="p">,</span> <span class="n">nRepeat</span><span class="p">,</span> <span class="n">cores</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the confusion matrix with/without correction methods by regression.</span>

<span class="sd">    :param data: Test Matrix. numpy array.</span>
<span class="sd">    :type data: array</span>
<span class="sd">    :param EffectSizes: effect size matrix, numpy array 1 x n</span>
<span class="sd">    :type EffectSizes: array</span>
<span class="sd">    :param SampSizes: Sample size matrix, numpy array 1 x n</span>
<span class="sd">    :type SampSizes: array</span>
<span class="sd">    :param SignThreshold: Threshold of significance level.This tool uses 0.05.</span>
<span class="sd">    :type SignThreshold: float</span>
<span class="sd">    :param nSimSamp: number of simulated samples. This tool uses 5000.</span>
<span class="sd">    :type nSimSamp: int</span>
<span class="sd">    :param nRepeat: number of repeats in the calculation of confusion matrix using simulated data.By default it is set to 10.</span>
<span class="sd">    :type nRepeat: int</span>
<span class="sd">    :param cores: number of CPU cores to be used for parallel.</span>
<span class="sd">    :type cores: int</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">##If sample size bigger than number of simulated samples adjust it</span>
    <span class="n">sampSizes</span> <span class="o">=</span> <span class="n">SampSizes</span>
    <span class="n">signThreshold</span> <span class="o">=</span> <span class="n">SignThreshold</span>
    <span class="n">effectSizes</span> <span class="o">=</span> <span class="n">EffectSizes</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">nSimSamp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of simulated samples smaller than maximum of samplesizes to check - increased&#39;</span><span class="p">)</span>
            <span class="n">nSimSamp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">nSimSamp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of simulated samples smaller than maximum of samplesizes to check - increased&#39;</span><span class="p">)</span>
            <span class="n">nSimSamp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">))</span> <span class="o">+</span> <span class="mi">500</span>
    <span class="c1">## convert matrix to numpy array type if needed</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1">##get data array size</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1">##Number of variables</span>
    <span class="n">numVars</span> <span class="o">=</span> <span class="n">cols</span>
    <span class="n">nRepeats</span> <span class="o">=</span> <span class="n">nRepeat</span>

    <span class="c1">##Number of sample and effect sizes</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sampSizes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">nSampSizes</span> <span class="o">=</span> <span class="n">sampSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">sampSizes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">nSampSizes</span> <span class="o">=</span> <span class="n">sampSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">effectSizes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">nEffSizes</span> <span class="o">=</span> <span class="n">effectSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">effectSizes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">nEffSizes</span> <span class="o">=</span> <span class="n">effectSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1">##Simulation of a new data set based on multivariate normal distribution</span>
    <span class="n">Samples</span><span class="p">,</span> <span class="n">correlationMat</span> <span class="o">=</span> <span class="n">simulateLogNormal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;Estimate&#39;</span><span class="p">,</span> <span class="n">nSimSamp</span><span class="p">)</span>
    <span class="n">Samples_seg</span> <span class="o">=</span> <span class="n">Samples</span>
    <span class="n">correlationMat_seg</span> <span class="o">=</span> <span class="n">correlationMat</span>

    <span class="c1">## Initialize the output structures</span>
    <span class="n">output2</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">##define an array for storing the results in each step of repeat for all variables</span>
    <span class="c1">##with all effect sizes and sample sizes;</span>
    <span class="n">output_allsteps_tmp</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">cores</span><span class="p">)</span>
    <span class="n">output2</span> <span class="o">=</span> <span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">f_multiproc_cont</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span> \
        <span class="n">sampSizes</span><span class="p">,</span> <span class="n">signThreshold</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">Samples_seg</span><span class="p">,</span> <span class="n">correlationMat_seg</span><span class="p">,</span> \
        <span class="n">cols</span><span class="p">,</span> <span class="n">cores</span><span class="p">,</span> <span class="n">wk</span><span class="p">))</span> <span class="k">for</span> <span class="n">wk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cores</span><span class="p">)]</span>
    <span class="n">output2</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">output2</span><span class="p">]</span>
    <span class="n">output3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="c1"># Unpack results</span>
    <span class="k">for</span> <span class="n">instanceOutput</span> <span class="ow">in</span> <span class="n">output2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">instanceOutput</span><span class="p">:</span>
            <span class="n">output3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="c1">##pass the results to output</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">##work out number of overall results and number of power rate results</span>
    <span class="n">num_overall_results</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">numVars</span> <span class="o">/</span> <span class="n">cores</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">novr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_overall_results</span><span class="p">):</span>
        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">novr</span><span class="p">])</span>

    <span class="c1">##pass Power TPR results to output variables</span>
    <span class="n">output_uncTP</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">output_bonfTP</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">output_bhTP</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">output_byTP</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">output_uncTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">num_overall_results</span><span class="p">])</span>
    <span class="n">output_bonfTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">output_bhTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">output_byTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">cores</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">novr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_overall_results</span><span class="p">):</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">novr</span><span class="p">])</span>

            <span class="n">output_uncTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP</span><span class="p">,</span> <span class="n">output3</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_overall_results</span><span class="p">],</span>
                                     <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">output_bonfTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP</span><span class="p">,</span> <span class="n">output3</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                      <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">output_bhTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP</span><span class="p">,</span> <span class="n">output3</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
                                    <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">output_byTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP</span><span class="p">,</span> <span class="n">output3</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                                    <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">rest_num_overall_results</span> <span class="o">=</span> <span class="n">numVars</span> <span class="o">-</span> <span class="n">num_overall_results</span> <span class="o">*</span> <span class="p">(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">novr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rest_num_overall_results</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output3</span><span class="p">[(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">novr</span><span class="p">])</span>
        <span class="n">output_uncTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP</span><span class="p">,</span>
                                 <span class="n">output3</span><span class="p">[(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">rest_num_overall_results</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">output_bonfTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP</span><span class="p">,</span>
                                  <span class="n">output3</span><span class="p">[(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">rest_num_overall_results</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                  <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">output_bhTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP</span><span class="p">,</span>
                                <span class="n">output3</span><span class="p">[(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">rest_num_overall_results</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">output_byTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP</span><span class="p">,</span>
                                <span class="n">output3</span><span class="p">[(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">rest_num_overall_results</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="c1">##for the mean proportion of number of variables achieve the power; and the std</span>
    <span class="n">output_uncTP_ratio_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_bonfTP_ratio_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_bhTP_ratio_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_byTP_ratio_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>

    <span class="n">output_uncTP_ratio_iqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_bonfTP_ratio_iqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_bhTP_ratio_iqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_byTP_ratio_iqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">currEff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">currSamp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">):</span>
            <span class="n">tmp_median_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">currStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">):</span>
                <span class="n">tmp_median_array</span><span class="p">[</span><span class="n">currStep</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span>
                    <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_uncTP</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">][:,</span> <span class="n">currStep</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numVars</span><span class="p">)</span>
            <span class="n">output_uncTP_ratio_median</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output_uncTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">scistats</span><span class="o">.</span><span class="n">iqr</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                         <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;midpoint&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">q75</span><span class="p">,</span> <span class="n">q25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">output_uncTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">q75</span> <span class="o">-</span> <span class="n">q25</span>

            <span class="n">tmp_median_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">currStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">):</span>
                <span class="n">tmp_median_array</span><span class="p">[</span><span class="n">currStep</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span>
                    <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_bonfTP</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">][:,</span> <span class="n">currStep</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numVars</span><span class="p">)</span>
            <span class="n">output_bonfTP_ratio_median</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output_bonfTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">scistats</span><span class="o">.</span><span class="n">iqr</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                          <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;midpoint&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">q75</span><span class="p">,</span> <span class="n">q25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">output_bonfTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">q75</span> <span class="o">-</span> <span class="n">q25</span>

            <span class="n">tmp_median_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">currStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">):</span>
                <span class="n">tmp_median_array</span><span class="p">[</span><span class="n">currStep</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span>
                    <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_bhTP</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">][:,</span> <span class="n">currStep</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numVars</span><span class="p">)</span>
            <span class="n">output_bhTP_ratio_median</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output_bhTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">scistats</span><span class="o">.</span><span class="n">iqr</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;midpoint&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">q75</span><span class="p">,</span> <span class="n">q25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">output_bhTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">q75</span> <span class="o">-</span> <span class="n">q25</span>

            <span class="n">tmp_median_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">currStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">):</span>
                <span class="n">tmp_median_array</span><span class="p">[</span><span class="n">currStep</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span>
                    <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_byTP</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">][:,</span> <span class="n">currStep</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numVars</span><span class="p">)</span>
            <span class="n">output_byTP_ratio_median</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output_byTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">scistats</span><span class="o">.</span><span class="n">iqr</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;midpoint&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">q75</span><span class="p">,</span> <span class="n">q25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">output_byTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">q75</span> <span class="o">-</span> <span class="n">q25</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">output_uncTP_ratio_median</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_median</span><span class="p">,</span> <span class="n">output_bhTP_ratio_median</span><span class="p">,</span> <span class="n">output_byTP_ratio_median</span><span class="p">,</span> \
               <span class="n">output_uncTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_bhTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_byTP_ratio_iqr</span><span class="p">,</span> \
               <span class="n">output_uncTP</span><span class="p">,</span> <span class="n">output_bonfTP</span><span class="p">,</span> <span class="n">output_bhTP</span><span class="p">,</span> <span class="n">output_byTP</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error occurs when returning output&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="f_multiproc_cont"><a class="viewcode-back" href="../pa.html#pa.f_multiproc_cont">[docs]</a><span class="k">def</span> <span class="nf">f_multiproc_cont</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">,</span> <span class="n">signThreshold</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">Samples_seg</span><span class="p">,</span>
                 <span class="n">correlationMat_seg</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">cores</span><span class="p">,</span> <span class="n">currCore</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lauch parallel computing for PCalc_Continuous.</span>

<span class="sd">    :param sampSizes: Sample size matrix, numpy array 1 x n.</span>
<span class="sd">    :type sampSizes: array</span>
<span class="sd">    :param signThreshold: Threshold of significance level.This tool uses 0.05.</span>
<span class="sd">    :type signThreshold: float</span>
<span class="sd">    :param effectSizes: Effect size matrix, numpy array 1 x n.</span>
<span class="sd">    :type effectSizes: array</span>
<span class="sd">    :param numVars: number of variables in current CPU core.</span>
<span class="sd">    :type numVars: int</span>
<span class="sd">    :param nRepeats: number of repeats in the calculation of confusion matrix using simulated data.By default it is set to 10.</span>
<span class="sd">    :type nRepeats: int</span>
<span class="sd">    :param nSampSizes: length of Sample size matrix.</span>
<span class="sd">    :type nSampSizes: int</span>
<span class="sd">    :param nEffSizes: length of effect size matrix.</span>
<span class="sd">    :type nEffSizes: int</span>
<span class="sd">    :param Samples_seg: Segment of simulated sample data. Numpy array.</span>
<span class="sd">    :type Samples_seg: array</span>
<span class="sd">    :param correlationMat_seg: Segment of correlation matrix on the simulated sample data. Numpy array.</span>
<span class="sd">    :type correlationMat_seg: array</span>
<span class="sd">    :param cols: number of variables to be used for calculation.</span>
<span class="sd">    :type cols: int</span>
<span class="sd">    :param cores: number of CPU cores to be used.</span>
<span class="sd">    :type cores: int</span>
<span class="sd">    :param currCore: current CPU core in use.</span>
<span class="sd">    :type currCore: int</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">##re-check numVars</span>
    <span class="n">offSet</span> <span class="o">=</span> <span class="n">currCore</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cols</span> <span class="o">/</span> <span class="n">cores</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">currCore</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">numVars</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cols</span> <span class="o">/</span> <span class="n">cores</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">numVars</span> <span class="o">=</span> <span class="n">cols</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cols</span> <span class="o">/</span> <span class="n">cores</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1">##for storing all results in all repeated steps with all effect sizes and sample</span>
    <span class="c1">##sizes for Power (TP) in current samples_seg</span>
    <span class="n">output_all_uncTP_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">))</span>
    <span class="n">output_all_bonfTP_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">))</span>
    <span class="n">output_all_bhTP_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">))</span>
    <span class="n">output_all_byTP_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">))</span>

    <span class="c1">##for storing results of all metric and correction options under the combination</span>
    <span class="c1">##of effect size and sample size for all variables</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>

    <span class="c1">##define uncStruct -- dictionary data</span>
    <span class="n">uncStruct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                 <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                 <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                 <span class="s1">&#39;STP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                 <span class="s1">&#39;SFP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;STN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                 <span class="s1">&#39;SFN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                 <span class="s1">&#39;SFD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))}</span>

    <span class="n">bonfStruct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                  <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                  <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                  <span class="s1">&#39;STP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                  <span class="s1">&#39;SFP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;STN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                  <span class="s1">&#39;SFN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                  <span class="s1">&#39;SFD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))}</span>

    <span class="n">bhStruct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;STP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;SFP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;STN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;SFN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;SFD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))}</span>

    <span class="n">byStruct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;STP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;SFP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;STN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;SFN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;SFD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))}</span>

    <span class="k">for</span> <span class="n">currVar</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numVars</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">currEff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">):</span>
            <span class="n">b1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">cols</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">b1</span><span class="p">[</span><span class="n">currVar</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">effectSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">currEff</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">currSampSize</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">):</span>
                <span class="c1">## define the structural data multiplerepeats</span>
                <span class="k">class</span> <span class="nc">MUltiplerepeats</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Results</span><span class="p">,</span> <span class="n">Bonferroni</span><span class="p">,</span> <span class="n">BenjHoch</span><span class="p">,</span> <span class="n">BenjYek</span><span class="p">,</span> <span class="n">noCorrection</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Results</span> <span class="o">=</span> <span class="n">Results</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Bonferroni</span> <span class="o">=</span> <span class="n">Bonferroni</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">BenjHoch</span> <span class="o">=</span> <span class="n">BenjHoch</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">BenjYek</span> <span class="o">=</span> <span class="n">BenjYek</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">noCorrection</span> <span class="o">=</span> <span class="n">noCorrection</span>

                <span class="n">multiplerepeats</span> <span class="o">=</span> <span class="n">MUltiplerepeats</span><span class="p">(</span>
                    <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span>
                     <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)},</span> \
                    <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span>
                     <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)},</span> \
                    <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span>
                     <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)},</span> \
                    <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span>
                     <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)},</span> \
                    <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span>
                     <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)})</span>

                <span class="k">for</span> <span class="n">currRepeat</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">):</span>
                    <span class="c1">## Select a subset of the simulated spectra</span>
                    <span class="n">selectIndex</span> <span class="o">=</span> <span class="n">randperm1</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">])</span>


                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">selectIndex</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">):</span>
                        <span class="n">selectIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">selectIndex</span><span class="p">)</span>
                    <span class="n">SelSamples</span> <span class="o">=</span> <span class="n">Samples_seg</span><span class="p">[</span><span class="n">selectIndex</span><span class="p">]</span>  <span class="c1"># matrix slicing by rows</span>


                    <span class="c1">## UVScaling the data</span>
                    <span class="n">stDev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">SelSamples</span><span class="p">,</span>
                                   <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># without argument ddof=1 means using default ddof=0 to work out std on population</span>
                    <span class="n">SelSamples</span> <span class="o">=</span> <span class="n">SelSamples</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">SelSamples</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">SelSamples</span> <span class="o">=</span> <span class="n">SelSamples</span> <span class="o">/</span> <span class="n">stDev</span>

                    <span class="n">noiseLevel</span> <span class="o">=</span> <span class="mi">1</span>

                    <span class="n">noise</span> <span class="o">=</span> <span class="n">noiseLevel</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="c1">#noise = noiseLevel * np.random.normal(0, 1, sampSizes[0][currSampSize])</span>
                    <span class="c1">#noise = np.reshape(noise, (len(noise),1))</span>

                    <span class="n">Y</span> <span class="o">=</span> <span class="n">SelSamples</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">currVar</span><span class="p">])]</span> <span class="o">*</span> <span class="n">b1</span><span class="p">[</span><span class="n">currVar</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">+</span> <span class="n">noise</span>

                    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>

                    <span class="c1">##Using regress for multivariate regression test</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
                        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">SelSamples</span><span class="p">[:,</span> <span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">stats_result</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>  <span class="c1"># ordinary least square linear regression</span>
                        <span class="c1">#stats_result1 = stats_result.predict(B)</span>
                        <span class="c1"># OLS. The result of OLS has attributes such as</span>
                        <span class="c1"># .rsquared as R^2, .fvalue as F-statistics</span>
                        <span class="c1"># .f_pvalue as p-value of F-stats, .scale as error variance</span>

                        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_result</span><span class="o">.</span><span class="n">f_pvalue</span>

                    <span class="n">pUnc</span> <span class="o">=</span> <span class="n">p</span>  <span class="c1">##pUnc and p have 1xnumVars elements</span>
                    <span class="n">pBonf</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">numVars</span>

                    <span class="n">h1</span><span class="p">,</span> <span class="n">crit_p</span><span class="p">,</span> <span class="n">adj_ci_cvrg</span><span class="p">,</span> <span class="n">pBY</span> <span class="o">=</span> <span class="n">fdr_bh</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;dep&#39;</span><span class="p">)</span>
                    <span class="n">h1</span><span class="p">,</span> <span class="n">crit_p</span><span class="p">,</span> <span class="n">adj_ci_cvrg</span><span class="p">,</span> <span class="n">pBH</span> <span class="o">=</span> <span class="n">fdr_bh</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;pdep&#39;</span><span class="p">)</span>

                    <span class="c1">##</span>
                    <span class="c1">#corrVector = np.array([])</span>
                    <span class="n">corrVector</span> <span class="o">=</span> <span class="n">correlationMat_seg</span><span class="p">[:,</span> <span class="n">currVar</span> <span class="o">+</span> <span class="n">offSet</span><span class="p">]</span>

                    <span class="n">uncTNTot</span><span class="p">,</span> <span class="n">uncTPTot</span><span class="p">,</span> <span class="n">uncFPTot</span><span class="p">,</span> <span class="n">uncFNTot</span><span class="p">,</span> <span class="n">uncFDTot</span> <span class="o">=</span> <span class="n">calcConfMatrixUniv</span><span class="p">(</span><span class="n">pUnc</span><span class="p">,</span> <span class="n">corrVector</span><span class="p">,</span>
                                                                                          <span class="n">signThreshold</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
                    <span class="n">bonfTNTot</span><span class="p">,</span> <span class="n">bonfTPTot</span><span class="p">,</span> <span class="n">bonfFPTot</span><span class="p">,</span> <span class="n">bonfFNTot</span><span class="p">,</span> <span class="n">bonfFDTot</span> <span class="o">=</span> <span class="n">calcConfMatrixUniv</span><span class="p">(</span><span class="n">pBonf</span><span class="p">,</span> <span class="n">corrVector</span><span class="p">,</span>
                                                                                               <span class="n">signThreshold</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>

                    <span class="n">byTNTot</span><span class="p">,</span> <span class="n">byTPTot</span><span class="p">,</span> <span class="n">byFPTot</span><span class="p">,</span> <span class="n">byFNTot</span><span class="p">,</span> <span class="n">byFDTot</span> <span class="o">=</span> <span class="n">calcConfMatrixUniv</span><span class="p">(</span><span class="n">pBY</span><span class="p">,</span> <span class="n">corrVector</span><span class="p">,</span> <span class="n">signThreshold</span><span class="p">,</span>
                                                                                     <span class="mf">0.8</span><span class="p">)</span>
                    <span class="n">bhTNTot</span><span class="p">,</span> <span class="n">bhTPTot</span><span class="p">,</span> <span class="n">bhFPTot</span><span class="p">,</span> <span class="n">bhFNTot</span><span class="p">,</span> <span class="n">bhFDTot</span> <span class="o">=</span> <span class="n">calcConfMatrixUniv</span><span class="p">(</span><span class="n">pBH</span><span class="p">,</span> <span class="n">corrVector</span><span class="p">,</span> <span class="n">signThreshold</span><span class="p">,</span>
                                                                                     <span class="mf">0.8</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncTPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">],</span>
                                                                       <span class="n">uncTPTot</span><span class="p">)</span>  <span class="c1"># if array index exceeds upper bound, extend the array</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncFPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">],</span> <span class="n">uncFPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncTNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">],</span> <span class="n">uncTNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncFNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">],</span> <span class="n">uncFNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncFDTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">],</span> <span class="n">uncFDTot</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfTPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">],</span> <span class="n">bonfTPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfFPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">],</span> <span class="n">bonfFPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfTNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">],</span> <span class="n">bonfTNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfFNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">],</span> <span class="n">bonfFNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfFDTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">],</span> <span class="n">bonfFDTot</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhTPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">],</span> <span class="n">bhTPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhFPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">],</span> <span class="n">bhFPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhTNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">],</span> <span class="n">bhTNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhFNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">],</span> <span class="n">bhFNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhFDTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">],</span> <span class="n">bhFDTot</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">byTPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">],</span> <span class="n">byTPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">byFPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">],</span> <span class="n">byFPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">byTNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">],</span> <span class="n">byTNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">byFNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">],</span> <span class="n">byFNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">byFDTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">],</span> <span class="n">byFDTot</span><span class="p">)</span>

                <span class="c1">##storing each step of repeats</span>
                <span class="n">output_all_uncTP_tmp</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">][</span><span class="n">currVar</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span>
                <span class="n">output_all_bonfTP_tmp</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">][</span><span class="n">currVar</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span>
                <span class="n">output_all_bhTP_tmp</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">][</span><span class="n">currVar</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span>
                <span class="n">output_all_byTP_tmp</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">][</span><span class="n">currVar</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span>

                <span class="c1">##end of for currRepeat in range(0, nRepeats):</span>

                <span class="c1">##get multiplerepeats.Bonferroni keys/fields</span>
                <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">currstat</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
                    <span class="n">uncStruct</span><span class="p">[</span><span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>
                    <span class="n">uncStruct</span><span class="p">[</span><span class="s1">&#39;S&#39;</span> <span class="o">+</span> <span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>

                    <span class="n">bonfStruct</span><span class="p">[</span><span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>
                    <span class="n">bonfStruct</span><span class="p">[</span><span class="s1">&#39;S&#39;</span> <span class="o">+</span> <span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>

                    <span class="n">byStruct</span><span class="p">[</span><span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>
                    <span class="n">byStruct</span><span class="p">[</span><span class="s1">&#39;S&#39;</span> <span class="o">+</span> <span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>

                    <span class="n">bhStruct</span><span class="p">[</span><span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>
                    <span class="n">bhStruct</span><span class="p">[</span><span class="s1">&#39;S&#39;</span> <span class="o">+</span> <span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>

        <span class="c1">## end of for currEff in range(1,nEffSizes+1):</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">uncStruct</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">byStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">byStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|| </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_all_uncTP_tmp</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_all_bonfTP_tmp</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_all_bhTP_tmp</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_all_byTP_tmp</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error occurs when returning output in parallel&#39;</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">randperm1</span><span class="p">(</span><span class="n">totalLen</span><span class="p">):</span>
    <span class="c1">##function of random permuation and pick up the sub array according to the specified size</span>
    <span class="n">tempList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">totalLen</span><span class="p">)</span>  <span class="c1">##generate a random permutation array</span>
    <span class="k">return</span> <span class="n">tempList</span>


<span class="c1">##=======End of PCalc_Continuous====================</span>

<span class="c1">##=======Beginning of PCalc_2Group====================</span>
<div class="viewcode-block" id="PCalc_2Group"><a class="viewcode-back" href="../pa.html#pa.PCalc_2Group">[docs]</a><span class="k">def</span> <span class="nf">PCalc_2Group</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">EffectSizes</span><span class="p">,</span> <span class="n">SampSizes</span><span class="p">,</span> <span class="n">SignThreshold</span><span class="p">,</span> <span class="n">nSimSamp</span><span class="p">,</span> <span class="n">nRepeat</span><span class="p">,</span> <span class="n">cores</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the confusion matrix with/without correction methods by classification.</span>

<span class="sd">    :param data: Test Matrix. numpy array.</span>
<span class="sd">    :type data: array</span>
<span class="sd">    :param EffectSizes: effect size matrix, numpy array 1 x n</span>
<span class="sd">    :type EffectSizes: array</span>
<span class="sd">    :param SampSizes: Sample size matrix, numpy array 1 x n</span>
<span class="sd">    :type SampSizes: array</span>
<span class="sd">    :param SignThreshold: Threshold of significance level.This tool uses 0.05.</span>
<span class="sd">    :type SignThreshold: float</span>
<span class="sd">    :param nSimSamp: number of simulated samples. This tool uses 5000.</span>
<span class="sd">    :type nSimSamp: int</span>
<span class="sd">    :param nRepeat: number of repeats in the calculation of confusion matrix using simulated data.By default it is set to 10.</span>
<span class="sd">    :type nRepeat: int</span>
<span class="sd">    :param cores: number of CPU cores to be used for parallel.</span>
<span class="sd">    :type cores: int</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">##If sample size bigger than number of simulated samples adjust it</span>
    <span class="c1">## global sampSizes, signThreshold, effectSizes, numVars, nRepeats, nSampSizes, nEffSizes, Samples_seg, correlationMat_seg, output2</span>
    <span class="c1">## global output2</span>
    <span class="n">sampSizes</span> <span class="o">=</span> <span class="n">SampSizes</span>
    <span class="n">signThreshold</span> <span class="o">=</span> <span class="n">SignThreshold</span>
    <span class="n">effectSizes</span> <span class="o">=</span> <span class="n">EffectSizes</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">nSimSamp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of simulated samples smaller than maximum of samplesizes to check - increased&#39;</span><span class="p">)</span>
            <span class="n">nSimSamp</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">500</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">nSimSamp</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of simulated samples smaller than maximum of samplesizes to check - increased&#39;</span><span class="p">)</span>
            <span class="n">nSimSamp</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">))</span> <span class="o">+</span> <span class="mi">500</span>
    <span class="c1">## convert matrix to numpy array type if needed</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1">##get data array size</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1">##Number of variables</span>
    <span class="n">numVars</span> <span class="o">=</span> <span class="n">cols</span>

    <span class="n">nRepeats</span> <span class="o">=</span> <span class="n">nRepeat</span>

    <span class="c1">##Number of sample and effect sizes</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sampSizes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">nSampSizes</span> <span class="o">=</span> <span class="n">sampSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">sampSizes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">nSampSizes</span> <span class="o">=</span> <span class="n">sampSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">effectSizes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">nEffSizes</span> <span class="o">=</span> <span class="n">effectSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">effectSizes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">nEffSizes</span> <span class="o">=</span> <span class="n">effectSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1">##Simulation of a new data set based on multivariate normal distribution</span>
    <span class="n">Samples</span><span class="p">,</span> <span class="n">correlationMat</span> <span class="o">=</span> <span class="n">simulateLogNormal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;Estimate&#39;</span><span class="p">,</span> <span class="n">nSimSamp</span><span class="p">)</span>

    <span class="n">Samples_seg</span> <span class="o">=</span> <span class="n">Samples</span>
    <span class="n">correlationMat_seg</span> <span class="o">=</span> <span class="n">correlationMat</span>
    <span class="n">output2</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">##define an array for storing the results in each step of repeat for all variables</span>
    <span class="c1">##with all effect sizes and sample sizes;</span>
    <span class="n">output_allsteps_tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">## #debug - using another multiporcessing method to run f_multiproc</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">cores</span><span class="p">)</span>
    <span class="n">output2</span> <span class="o">=</span> <span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">f_multiproc</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span>
    <span class="n">sampSizes</span><span class="p">,</span> <span class="n">signThreshold</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">Samples_seg</span><span class="p">,</span> <span class="n">correlationMat_seg</span><span class="p">,</span>
    <span class="n">cols</span><span class="p">,</span> <span class="n">cores</span><span class="p">,</span> <span class="n">wk</span><span class="p">))</span> <span class="k">for</span> <span class="n">wk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cores</span><span class="p">)]</span>
    <span class="n">output2</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">output2</span><span class="p">]</span>
    <span class="n">output3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="c1"># Unpack results</span>
    <span class="k">for</span> <span class="n">instanceOutput</span> <span class="ow">in</span> <span class="n">output2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">instanceOutput</span><span class="p">:</span>
            <span class="n">output3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="c1">## output2 = Parallel(n_jobs=cores)(delayed(f_multiproc)(sampSizes, signThreshold, effectSizes, numVars, nRepeats, nSampSizes, nEffSizes, Samples_seg, correlationMat_seg, cols, cores, ii) for ii in range(cores))            #n_jobs=-1 means using all CPUs or any other number&gt;1 to specify the number of CPUs to use</span>
            <span class="c1">## for ii in range(numVars): ##for non-parallel running</span>
            <span class="c1">## f_multiproc(ii)</span>
    <span class="c1">##pass the results to output</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">##work out number of overall results and number of power rate results</span>
    <span class="n">num_overall_results</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">numVars</span> <span class="o">/</span> <span class="n">cores</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">novr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_overall_results</span><span class="p">):</span>
        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">novr</span><span class="p">])</span>

    <span class="c1">##pass Power TPR results to output variables</span>
    <span class="n">output_uncTP</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">output_bonfTP</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">output_bhTP</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">output_byTP</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">output_uncTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">num_overall_results</span><span class="p">])</span>
    <span class="n">output_bonfTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">output_bhTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">output_byTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">cores</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">novr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_overall_results</span><span class="p">):</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output3</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">novr</span><span class="p">])</span>

            <span class="n">output_uncTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP</span><span class="p">,</span> <span class="n">output3</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_overall_results</span><span class="p">],</span>
                                     <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">output_bonfTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP</span><span class="p">,</span> <span class="n">output3</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                      <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">output_bhTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP</span><span class="p">,</span> <span class="n">output3</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
                                    <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">output_byTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP</span><span class="p">,</span> <span class="n">output3</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span>
                                    <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">rest_num_overall_results</span> <span class="o">=</span> <span class="n">numVars</span> <span class="o">-</span> <span class="n">num_overall_results</span> <span class="o">*</span> <span class="p">(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">novr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rest_num_overall_results</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output3</span><span class="p">[(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">novr</span><span class="p">])</span>
        <span class="n">output_uncTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP</span><span class="p">,</span>
                                 <span class="n">output3</span><span class="p">[(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">rest_num_overall_results</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">output_bonfTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP</span><span class="p">,</span>
                                  <span class="n">output3</span><span class="p">[(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">rest_num_overall_results</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                                  <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">output_bhTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP</span><span class="p">,</span>
                                <span class="n">output3</span><span class="p">[(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">rest_num_overall_results</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">output_byTP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP</span><span class="p">,</span>
                                <span class="n">output3</span><span class="p">[(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_overall_results</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">rest_num_overall_results</span> <span class="o">+</span> <span class="mi">3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="c1">##for the mean proportion of number of variables achieve the power; and the std</span>
    <span class="n">output_uncTP_ratio_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_bonfTP_ratio_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_bhTP_ratio_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_byTP_ratio_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>

    <span class="n">output_uncTP_ratio_iqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_bonfTP_ratio_iqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_bhTP_ratio_iqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
    <span class="n">output_byTP_ratio_iqr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">currEff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">currSamp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">):</span>
            <span class="n">tmp_median_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">currStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">):</span>
                <span class="n">tmp_median_array</span><span class="p">[</span><span class="n">currStep</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span>
                    <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_uncTP</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">][:,</span> <span class="n">currStep</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numVars</span><span class="p">)</span>
            <span class="n">output_uncTP_ratio_median</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output_uncTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">scistats</span><span class="o">.</span><span class="n">iqr</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                         <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;midpoint&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">q75</span><span class="p">,</span> <span class="n">q25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">output_uncTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">q75</span> <span class="o">-</span> <span class="n">q25</span>

            <span class="n">tmp_median_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">currStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">):</span>
                <span class="n">tmp_median_array</span><span class="p">[</span><span class="n">currStep</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span>
                    <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_bonfTP</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">][:,</span> <span class="n">currStep</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numVars</span><span class="p">)</span>
            <span class="n">output_bonfTP_ratio_median</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output_bonfTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">scistats</span><span class="o">.</span><span class="n">iqr</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                          <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;midpoint&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">q75</span><span class="p">,</span> <span class="n">q25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">output_bonfTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">q75</span> <span class="o">-</span> <span class="n">q25</span>

            <span class="n">tmp_median_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">currStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">):</span>
                <span class="n">tmp_median_array</span><span class="p">[</span><span class="n">currStep</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span>
                    <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_bhTP</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">][:,</span> <span class="n">currStep</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numVars</span><span class="p">)</span>
            <span class="n">output_bhTP_ratio_median</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output_bhTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">scistats</span><span class="o">.</span><span class="n">iqr</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;midpoint&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">q75</span><span class="p">,</span> <span class="n">q25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">output_bhTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">q75</span> <span class="o">-</span> <span class="n">q25</span>

            <span class="n">tmp_median_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">currStep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">):</span>
                <span class="n">tmp_median_array</span><span class="p">[</span><span class="n">currStep</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span>
                    <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output_byTP</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">][:,</span> <span class="n">currStep</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numVars</span><span class="p">)</span>
            <span class="n">output_byTP_ratio_median</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output_byTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">scistats</span><span class="o">.</span><span class="n">iqr</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                                        <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;midpoint&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">q75</span><span class="p">,</span> <span class="n">q25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">tmp_median_array</span><span class="p">,</span> <span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">output_byTP_ratio_iqr</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">q75</span> <span class="o">-</span> <span class="n">q25</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">output_uncTP_ratio_median</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_median</span><span class="p">,</span> <span class="n">output_bhTP_ratio_median</span><span class="p">,</span> <span class="n">output_byTP_ratio_median</span><span class="p">,</span> \
               <span class="n">output_uncTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_bhTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_byTP_ratio_iqr</span><span class="p">,</span> \
               <span class="n">output_uncTP</span><span class="p">,</span> <span class="n">output_bonfTP</span><span class="p">,</span> <span class="n">output_bhTP</span><span class="p">,</span> <span class="n">output_byTP</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error occurs when returning output&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="f_multiproc"><a class="viewcode-back" href="../pa.html#pa.f_multiproc">[docs]</a><span class="k">def</span> <span class="nf">f_multiproc</span><span class="p">(</span><span class="n">sampSizes</span><span class="p">,</span> <span class="n">signThreshold</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">Samples_seg</span><span class="p">,</span>
                <span class="n">correlationMat_seg</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">cores</span><span class="p">,</span> <span class="n">currCore</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lauch parallel computing for PCalc_2Group.</span>

<span class="sd">        :param sampSizes: Sample size matrix, numpy array 1 x n.</span>
<span class="sd">        :type sampSizes: array</span>
<span class="sd">        :param signThreshold: Threshold of significance level.This tool uses 0.05.</span>
<span class="sd">        :type signThreshold: float</span>
<span class="sd">        :param effectSizes: Effect size matrix, numpy array 1 x n.</span>
<span class="sd">        :type effectSizes: array</span>
<span class="sd">        :param numVars: number of variables in current core.</span>
<span class="sd">        :type numVars: int</span>
<span class="sd">        :param nRepeats: number of repeats in the calculation of confusion matrix using simulated data.By default it is set to 10.</span>
<span class="sd">        :type nRepeats: int</span>
<span class="sd">        :param nSampSizes: length of Sample size matrix.</span>
<span class="sd">        :type nSampSizes: int</span>
<span class="sd">        :param nEffSizes: length of effect size matrix.</span>
<span class="sd">        :type nEffSizes: int</span>
<span class="sd">        :param Samples_seg: Segment of simulated sample data. Numpy array.</span>
<span class="sd">        :type Samples_seg: array</span>
<span class="sd">        :param correlationMat_seg: Segment of correlation matrix on the simulated sample data. Numpy array.</span>
<span class="sd">        :type correlationMat_seg: array</span>
<span class="sd">        :param cols: number of variables to be used for calculation.</span>
<span class="sd">        :type cols: int</span>
<span class="sd">        :param cores: number of CPU cores to be used.</span>
<span class="sd">        :type cores: int</span>
<span class="sd">        :param currCore: current CPU core in use.</span>
<span class="sd">        :type currCore: int</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="c1">##re-check numVars</span>
    <span class="n">offSet</span> <span class="o">=</span> <span class="n">currCore</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cols</span> <span class="o">/</span> <span class="n">cores</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">currCore</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">numVars</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cols</span> <span class="o">/</span> <span class="n">cores</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">numVars</span> <span class="o">=</span> <span class="n">cols</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cols</span> <span class="o">/</span> <span class="n">cores</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">cores</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># debug</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;numVars=</span><span class="si">%d</span><span class="s2">; current core=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">numVars</span><span class="p">,</span> <span class="n">currCore</span><span class="p">))</span>
    <span class="c1">##for storing all results in all repeated steps with all effect sizes and sample</span>
    <span class="c1">##sizes for Power (TP) in current samples_seg</span>
    <span class="n">output_all_uncTP_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">))</span>
    <span class="n">output_all_bonfTP_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">))</span>
    <span class="n">output_all_bhTP_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">))</span>
    <span class="n">output_all_byTP_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">,</span> <span class="n">numVars</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">))</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>
        <span class="c1">##define uncStruct, bonfStruct, bhStruct, byStruct  -- dictionary data</span>
    <span class="c1">## the key&#39;s order, if retrieving by index, is FP,TN,FD,FN,SFD,STP,STN,SFN,SFP,TP</span>
    <span class="c1">##STP-- Standard deviation for True Positive prediction; SFP -- Standard deviation for False Positive prediction</span>
    <span class="n">uncStruct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                 <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                 <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                 <span class="s1">&#39;STP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                 <span class="s1">&#39;SFP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;STN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                 <span class="s1">&#39;SFN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                 <span class="s1">&#39;SFD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))}</span>

    <span class="n">bonfStruct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                  <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                  <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                  <span class="s1">&#39;STP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                  <span class="s1">&#39;SFP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;STN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                  <span class="s1">&#39;SFN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                  <span class="s1">&#39;SFD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))}</span>

    <span class="n">bhStruct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;STP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;SFP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;STN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;SFN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;SFD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))}</span>

    <span class="n">byStruct</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;STP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;SFP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="s1">&#39;STN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span>
                <span class="s1">&#39;SFN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> \
                <span class="s1">&#39;SFD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))}</span>
    <span class="k">for</span> <span class="n">currVar</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numVars</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">currEff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">currSampSize</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">):</span>
                <span class="c1">## define the structural data multiplerepeats</span>
                <span class="k">class</span> <span class="nc">MUltiplerepeats</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
                    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Results</span><span class="p">,</span> <span class="n">Bonferroni</span><span class="p">,</span> <span class="n">BenjHoch</span><span class="p">,</span> <span class="n">BenjYek</span><span class="p">,</span> <span class="n">noCorrection</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Results</span> <span class="o">=</span> <span class="n">Results</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Bonferroni</span> <span class="o">=</span> <span class="n">Bonferroni</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">BenjHoch</span> <span class="o">=</span> <span class="n">BenjHoch</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">BenjYek</span> <span class="o">=</span> <span class="n">BenjYek</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">noCorrection</span> <span class="o">=</span> <span class="n">noCorrection</span>

                <span class="n">multiplerepeats</span> <span class="o">=</span> <span class="n">MUltiplerepeats</span><span class="p">(</span>
                    <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span>
                     <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)},</span> \
                    <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span>
                     <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)},</span> \
                    <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span>
                     <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)},</span> \
                    <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span>
                     <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)},</span> \
                    <span class="p">{</span><span class="s1">&#39;TP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span>
                     <span class="s1">&#39;FN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">),</span> <span class="s1">&#39;FD&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nRepeats</span><span class="p">)})</span>
                <span class="k">for</span> <span class="n">currRepeat</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nRepeats</span><span class="p">):</span>
                    <span class="c1">## Select a subset of the simulated spectra</span>
                    <span class="n">selectIndex</span> <span class="o">=</span> <span class="n">randperm</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Samples_seg</span><span class="p">),</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sampSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">])</span>  <span class="c1">##sampSizes is a 1xn array</span>

                    <span class="c1">## check selectIndex is a numpy array, if not, then convert to numpy array.</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">selectIndex</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">):</span>
                        <span class="n">selectIndex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">selectIndex</span><span class="p">)</span>
                    <span class="n">SelSamples</span> <span class="o">=</span> <span class="n">Samples_seg</span><span class="p">[</span><span class="n">selectIndex</span><span class="p">]</span>  <span class="c1"># matrix slicing by rows</span>

                    <span class="c1">##Assume class balanced, modify proportion of group here</span>
                    <span class="n">GroupId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">SelSamples</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SelSamples</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">SelSamples</span><span class="p">)):</span>
                        <span class="n">GroupId</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

                    <span class="c1">##Introduce change</span>
                    <span class="n">corrVector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                    <span class="c1"># corrVector = correlationMat_seg[currCore][:,currVar] ##this line caused error of calculation on 2nd or other cores</span>
                    <span class="n">corrVector</span> <span class="o">=</span> <span class="n">correlationMat_seg</span><span class="p">[:,</span> <span class="n">currVar</span> <span class="o">+</span> <span class="n">offSet</span><span class="p">]</span>

                    <span class="n">stdSelSamples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">SelSamples</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">corrVector</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">GroupId</span><span class="p">)):</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">GroupId</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                                    <span class="c1">## stdSelSamples = np.std(SelSamples, axis=0, ddof=1)</span>
                                    <span class="n">SelSamples</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">SelSamples</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">effectSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">currEff</span><span class="p">]</span> <span class="o">*</span> <span class="n">stdSelSamples</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                    <span class="c1">##Initialize p value vector for this round</span>

                    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">var2check</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
                        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">var2check</span><span class="p">]</span> <span class="o">=</span> <span class="n">scistats</span><span class="o">.</span><span class="n">f_oneway</span><span class="p">(</span><span class="n">SelSamples</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SelSamples</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">var2check</span><span class="p">],</span>
                                                            <span class="n">SelSamples</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SelSamples</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span><span class="nb">len</span><span class="p">(</span><span class="n">SelSamples</span><span class="p">),</span>
                                                            <span class="n">var2check</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="c1">## tempSamples1 = []</span>
                        <span class="c1">## tempSamples2 = []</span>
                        <span class="c1">## for i in range(0, len(SelSamples)):</span>
                        <span class="c1">## if (GroupId[i][0]==1):</span>
                        <span class="c1">## tempSamples1.append(SelSamples[i][var2check])</span>
                        <span class="c1">## if (GroupId[i][0]==2):</span>
                        <span class="c1">## tempSamples2.append(SelSamples[i][var2check])</span>
                        <span class="c1">## p[0][var2check] = scistats.f_oneway(tempSamples1,tempSamples2)[1]</span>

                    <span class="n">pUnc</span> <span class="o">=</span> <span class="n">p</span>  <span class="c1">##pUnc and p have 1xnumVars elements</span>
                    <span class="n">pBonf</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">cols</span>  <span class="c1">##pBonf has 1xnumVars elements</span>

                    <span class="n">h1</span><span class="p">,</span> <span class="n">crit_p</span><span class="p">,</span> <span class="n">adj_ci_cvrg</span><span class="p">,</span> <span class="n">pBY</span> <span class="o">=</span> <span class="n">fdr_bh</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;dep&#39;</span><span class="p">)</span>
                    <span class="n">h1</span><span class="p">,</span> <span class="n">crit_p</span><span class="p">,</span> <span class="n">adj_ci_cvrg</span><span class="p">,</span> <span class="n">pBH</span> <span class="o">=</span> <span class="n">fdr_bh</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s1">&#39;pdep&#39;</span><span class="p">)</span>

                    <span class="n">uncTNTot</span><span class="p">,</span> <span class="n">uncTPTot</span><span class="p">,</span> <span class="n">uncFPTot</span><span class="p">,</span> <span class="n">uncFNTot</span><span class="p">,</span> <span class="n">uncFDTot</span> <span class="o">=</span> <span class="n">calcConfMatrixUniv</span><span class="p">(</span><span class="n">pUnc</span><span class="p">,</span> <span class="n">corrVector</span><span class="p">,</span>
                                                                                          <span class="n">signThreshold</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
                    <span class="n">bonfTNTot</span><span class="p">,</span> <span class="n">bonfTPTot</span><span class="p">,</span> <span class="n">bonfFPTot</span><span class="p">,</span> <span class="n">bonfFNTot</span><span class="p">,</span> <span class="n">bonfFDTot</span> <span class="o">=</span> <span class="n">calcConfMatrixUniv</span><span class="p">(</span><span class="n">pBonf</span><span class="p">,</span> <span class="n">corrVector</span><span class="p">,</span>
                                                                                               <span class="n">signThreshold</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>

                    <span class="n">byTNTot</span><span class="p">,</span> <span class="n">byTPTot</span><span class="p">,</span> <span class="n">byFPTot</span><span class="p">,</span> <span class="n">byFNTot</span><span class="p">,</span> <span class="n">byFDTot</span> <span class="o">=</span> <span class="n">calcConfMatrixUniv</span><span class="p">(</span><span class="n">pBY</span><span class="p">,</span> <span class="n">corrVector</span><span class="p">,</span> <span class="n">signThreshold</span><span class="p">,</span>
                                                                                     <span class="mf">0.8</span><span class="p">)</span>
                    <span class="n">bhTNTot</span><span class="p">,</span> <span class="n">bhTPTot</span><span class="p">,</span> <span class="n">bhFPTot</span><span class="p">,</span> <span class="n">bhFNTot</span><span class="p">,</span> <span class="n">bhFDTot</span> <span class="o">=</span> <span class="n">calcConfMatrixUniv</span><span class="p">(</span><span class="n">pBH</span><span class="p">,</span> <span class="n">corrVector</span><span class="p">,</span> <span class="n">signThreshold</span><span class="p">,</span>
                                                                                     <span class="mf">0.8</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncTPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">],</span>
                                                                       <span class="n">uncTPTot</span><span class="p">)</span>  <span class="c1"># if array index exceeds upper bound, extend the array</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncFPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">],</span> <span class="n">uncFPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncTNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">],</span> <span class="n">uncTNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncFNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">],</span> <span class="n">uncFNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncFDTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">],</span> <span class="n">uncFDTot</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfTPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">],</span> <span class="n">bonfTPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfFPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">],</span> <span class="n">bonfFPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfTNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">],</span> <span class="n">bonfTNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfFNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">],</span> <span class="n">bonfFNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfFDTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">],</span> <span class="n">bonfFDTot</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhTPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">],</span> <span class="n">bhTPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhFPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">],</span> <span class="n">bhFPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhTNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">],</span> <span class="n">bhTNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhFNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">],</span> <span class="n">bhFNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhFDTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">],</span> <span class="n">bhFDTot</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">byTPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">],</span> <span class="n">byTPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">byFPTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FP&#39;</span><span class="p">],</span> <span class="n">byFPTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">byTNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TN&#39;</span><span class="p">],</span> <span class="n">byTNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">byFNTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">],</span> <span class="n">byFNTot</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">][</span><span class="n">currRepeat</span><span class="p">]</span> <span class="o">=</span> <span class="n">byFDTot</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;FD&#39;</span><span class="p">],</span> <span class="n">byFDTot</span><span class="p">)</span>

                <span class="n">output_all_uncTP_tmp</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">][</span><span class="n">currVar</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span>
                <span class="n">output_all_bonfTP_tmp</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">][</span><span class="n">currVar</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span>
                <span class="n">output_all_bhTP_tmp</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">][</span><span class="n">currVar</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span>
                <span class="n">output_all_byTP_tmp</span><span class="p">[</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">][</span><span class="n">currVar</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="s1">&#39;TP&#39;</span><span class="p">]</span>

                <span class="c1">##get multiplerepeats.Bonferroni keys/fields</span>
                <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">currstat</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
                    <span class="n">uncStruct</span><span class="p">[</span><span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>
                    <span class="n">uncStruct</span><span class="p">[</span><span class="s1">&#39;S&#39;</span> <span class="o">+</span> <span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">noCorrection</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>

                    <span class="n">bonfStruct</span><span class="p">[</span><span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>
                    <span class="n">bonfStruct</span><span class="p">[</span><span class="s1">&#39;S&#39;</span> <span class="o">+</span> <span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">Bonferroni</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>

                    <span class="n">byStruct</span><span class="p">[</span><span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>
                    <span class="n">byStruct</span><span class="p">[</span><span class="s1">&#39;S&#39;</span> <span class="o">+</span> <span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjYek</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>

                    <span class="n">bhStruct</span><span class="p">[</span><span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>
                    <span class="n">bhStruct</span><span class="p">[</span><span class="s1">&#39;S&#39;</span> <span class="o">+</span> <span class="n">currstat</span><span class="p">][</span><span class="n">currEff</span><span class="p">][</span><span class="n">currSampSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">multiplerepeats</span><span class="o">.</span><span class="n">BenjHoch</span><span class="p">[</span><span class="n">currstat</span><span class="p">])</span>

        <span class="c1">## end of for currEff in range(0,nEffSizes):</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">uncStruct</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bonfStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bhStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">byStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nSampSizes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">nEffSizes</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nSampSizes</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">storeVar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nEffSizes</span><span class="p">,</span> <span class="n">nSampSizes</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">storeVar</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">byStruct</span><span class="p">[</span><span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

        <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storeVar</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;| </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_all_uncTP_tmp</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_all_bonfTP_tmp</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_all_bhTP_tmp</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_all_byTP_tmp</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error occurs when returning output in parallel&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="randperm"><a class="viewcode-back" href="../pa.html#pa.randperm">[docs]</a><span class="k">def</span> <span class="nf">randperm</span><span class="p">(</span><span class="n">totalLen</span><span class="p">,</span> <span class="n">subLen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is for random permuation and pick up the sub array according to the specified size</span>

<span class="sd">    :param totalLen: Total length.</span>
<span class="sd">    :type totalLen: int</span>
<span class="sd">    :param subLen: Sub length.</span>
<span class="sd">    :type subLen: int</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">##function of random permuation and pick up the sub array according to the specified size</span>
    <span class="c1">##np.random.seed(10)                                  ##add random seed for testing purpose</span>
    <span class="n">tempList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">totalLen</span><span class="p">)</span>  <span class="c1">##generate a random permutation array</span>
    <span class="c1">##random.seed(10)                                  ##add random seed for testing purpose</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tempList1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">tempList</span><span class="p">,</span> <span class="n">subLen</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">tempList1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tempList</span><span class="p">),</span> <span class="n">subLen</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tempList1</span></div>


<span class="c1">##=======End of PCalc_2Group====================</span>


<div class="viewcode-block" id="expecting"><a class="viewcode-back" href="../pa.html#pa.expecting">[docs]</a><span class="k">def</span> <span class="nf">expecting</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    function expecting is for detecting the number of outputs; written by Sami Hangaslammi</span>
<span class="sd">    Return how many values the caller is expecting</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_back</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_code</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">f_lasti</span>
    <span class="n">bytecode</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">co_code</span>
    <span class="n">instruction</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">bytecode</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">instruction</span> <span class="o">==</span> <span class="n">dis</span><span class="o">.</span><span class="n">opmap</span><span class="p">[</span><span class="s1">&#39;UNPACK_SEQUENCE&#39;</span><span class="p">]:</span>
        <span class="n">howmany</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">bytecode</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">howmany</span>
    <span class="k">elif</span> <span class="n">instruction</span> <span class="o">==</span> <span class="n">dis</span><span class="o">.</span><span class="n">opmap</span><span class="p">[</span><span class="s1">&#39;POP_TOP&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="fdr_bh"><a class="viewcode-back" href="../pa.html#pa.fdr_bh">[docs]</a><span class="k">def</span> <span class="nf">fdr_bh</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function false discovery rate by Benjamini-Hochberg correction</span>


<span class="sd">    :param args:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pvals</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">##convert to numpy array type if not the ndarray type</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">):</span>
            <span class="n">pvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usage: fdr_bh(&lt;arg1&gt;,&lt;arg2&gt;,&lt;arg3&gt;,&lt;arg4&gt;)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;arg1 as p-value matrix (mandatory must be provided&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;arg2 as false discovery rate(optional)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;arg3 as method:&#39;pdep&#39; or &#39;dep&#39;, &#39;pdep&#39; is given as default(optional)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;arg4 as report:&#39;yes&#39; or &#39;no&#39;, &#39;no&#39; is given as default(optional)&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;pdep&#39;</span>  <span class="c1">#&#39;pdep&#39; is for Benjamini-Hochberg correction method</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">report</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">pvals</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pvals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>  <span class="c1"># if pvals has more than 1 rows, reshape into 1 row array</span>
        <span class="n">reshaped_pvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
        <span class="n">p_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reshaped_pvals</span><span class="p">)</span>
        <span class="n">sort_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">reshaped_pvals</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># pvals is already 1xn array</span>
        <span class="n">p_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span>
        <span class="n">sort_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span>
    <span class="n">dummy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sort_ids</span><span class="p">)</span>
    <span class="n">unsort_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sort_ids</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_sorted</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;pdep&#39;</span><span class="p">):</span>
        <span class="c1">##BH procedure for independence or positive dependence</span>
        <span class="n">thresh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">/</span> <span class="n">m</span>
        <span class="n">wtd_p</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">p_sorted</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;dep&#39;</span><span class="p">):</span>
        <span class="c1">##BH procedure for any dependency structure</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">thresh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">q</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="n">wtd_p</span> <span class="o">=</span> <span class="n">denom</span> <span class="o">*</span> <span class="n">p_sorted</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Note, it can produce adjusted p-values greater than 1!</span>
<span class="sd">        compute adjusted p-values</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Argument </span><span class="se">\&#39;</span><span class="s1">method</span><span class="se">\&#39;</span><span class="s1"> needs to be </span><span class="se">\&#39;</span><span class="s1">pdep</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">dep</span><span class="se">\&#39;</span><span class="s1">.&#39;</span><span class="p">)</span>

    <span class="n">nargout</span> <span class="o">=</span> <span class="n">expecting</span><span class="p">()</span>  <span class="c1"># get the number of expecting outputs from caller</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nargout</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">):</span>
        <span class="c1">##compute adjusted p-values</span>
        <span class="n">adj_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
        <span class="n">wtd_p_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">wtd_p</span><span class="p">)</span>
        <span class="n">wtd_p_sindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">wtd_p</span><span class="p">)</span>
        <span class="n">nextfill</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">wtd_p_sindex</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">nextfill</span><span class="p">):</span>
                <span class="n">adj_p</span><span class="p">[</span><span class="n">nextfill</span><span class="p">:(</span><span class="n">wtd_p_sindex</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">wtd_p_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                <span class="n">nextfill</span> <span class="o">=</span> <span class="n">wtd_p_sindex</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nextfill</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">):</span>
                    <span class="k">break</span>
        <span class="n">adj_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">adj_p</span><span class="p">[</span><span class="n">unsort_ids</span><span class="p">],</span> <span class="n">s</span><span class="p">)</span>

    <span class="n">rej</span> <span class="o">=</span> <span class="n">p_sorted</span> <span class="o">&lt;=</span> <span class="n">thresh</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">max_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rej</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)))</span>  <span class="c1"># find greatest significant pvalue</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">max_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rej</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">max_id</span><span class="p">:</span>
        <span class="c1">## if the max_id is empty</span>
        <span class="n">crit_p</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">pvals</span> <span class="o">*</span> <span class="mi">0</span>
        <span class="n">adj_ci_cvrg</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">crit_p</span> <span class="o">=</span> <span class="n">p_sorted</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">max_id</span><span class="p">]</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">pvals</span> <span class="o">&lt;=</span> <span class="n">crit_p</span>
        <span class="n">adj_ci_cvrg</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">thresh</span><span class="p">[</span><span class="n">max_id</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">report</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">):</span>
        <span class="n">n_sig</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p_sorted</span> <span class="o">&lt;=</span> <span class="n">crit_p</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_sig</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Out of </span><span class="si">%d</span><span class="s1"> tests, </span><span class="si">%d</span><span class="s1"> is significant using a false discovery rate of </span><span class="si">%f</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n_sig</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Out of </span><span class="si">%d</span><span class="s1"> tests, </span><span class="si">%d</span><span class="s1"> are significant using a false discovery rate of </span><span class="si">%f</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n_sig</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;pdep&#39;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FDR/FCR procedure used is guaranteed valid for independent or positively dependent tests.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FDR/FCR procedure used is guaranteed valid for independent or dependent tests.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1">## return the results</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">h1</span><span class="p">,</span> <span class="n">crit_p</span><span class="p">,</span> <span class="n">adj_ci_cvrg</span><span class="p">,</span> <span class="n">adj_p</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors occur when returning h1, crit_p, adj_ci_cvrg and adj_p&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="calcConfMatrixUniv"><a class="viewcode-back" href="../pa.html#pa.calcConfMatrixUniv">[docs]</a><span class="k">def</span> <span class="nf">calcConfMatrixUniv</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">corrVector</span><span class="p">,</span> <span class="n">signThreshold</span><span class="p">,</span> <span class="n">corrThresh</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function of calculating confusion matrix</span>

<span class="sd">    :param p: p_value matrix. numpy array</span>
<span class="sd">    :type p: array</span>
<span class="sd">    :param corrVector: correlation vector.</span>
<span class="sd">    :type corrVector: array</span>
<span class="sd">    :param signThreshold: Significance threshold.</span>
<span class="sd">    :type signThreshold: float</span>
<span class="sd">    :param corrThresh: power level</span>
<span class="sd">    :type corrThresh: float</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TP</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">TN</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">FP</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">FN</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">Pf</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">signThreshold</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nVars</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">nVars</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nVars</span><span class="p">):</span>
        <span class="c1"># debugging</span>
        <span class="c1"># print &quot;fabsfabs(corrVector[%d])=%f; Pf[0][%d]=%r&quot;%(i,fabs(corrVector[i]),i, Pf[0][i])</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">fabs</span><span class="p">(</span><span class="n">corrVector</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">corrThresh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">Pf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)):</span>
            <span class="n">TN</span> <span class="o">=</span> <span class="n">TN</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># print &quot;TN=%d&quot;%(TN)</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">fabs</span><span class="p">(</span><span class="n">corrVector</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">corrThresh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">Pf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)):</span>
            <span class="n">TP</span> <span class="o">=</span> <span class="n">TP</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># print &quot;TP=%d&quot;%(TP)</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">fabs</span><span class="p">(</span><span class="n">corrVector</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">corrThresh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">Pf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)):</span>
            <span class="n">FN</span> <span class="o">=</span> <span class="n">FN</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># print &quot;FN=%d&quot;%(FN)</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">fabs</span><span class="p">(</span><span class="n">corrVector</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">corrThresh</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">Pf</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)):</span>
            <span class="n">FP</span> <span class="o">=</span> <span class="n">FP</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># print &quot;FP=%d&quot;%(FP)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">TNtot</span> <span class="o">=</span> <span class="n">TN</span> <span class="o">/</span> <span class="p">(</span><span class="n">FP</span> <span class="o">+</span> <span class="n">TN</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">TNtot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># TPR - power</span>
        <span class="n">TPtot</span> <span class="o">=</span> <span class="n">TP</span> <span class="o">/</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">FN</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">TPtot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
        <span class="c1"># TPtot = 0.0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">FPtot</span> <span class="o">=</span> <span class="n">FP</span> <span class="o">/</span> <span class="p">(</span><span class="n">FP</span> <span class="o">+</span> <span class="n">TN</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">FPtot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">FNtot</span> <span class="o">=</span> <span class="n">FN</span> <span class="o">/</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">FN</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">FNtot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">FDtot</span> <span class="o">=</span> <span class="n">FP</span> <span class="o">/</span> <span class="p">(</span><span class="n">TP</span> <span class="o">+</span> <span class="n">FP</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">FDtot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>

    <span class="c1">## return the results</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TNtot</span><span class="p">,</span> <span class="n">TPtot</span><span class="p">,</span> <span class="n">FPtot</span><span class="p">,</span> <span class="n">FNtot</span><span class="p">,</span> <span class="n">FDtot</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Errors occur when returning uncTNTot, uncTPTot, uncFPTot, uncFNTot, uncFDTot&quot;</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">read2array</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">dataArray</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
                <span class="n">dataArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
        <span class="n">dataArray</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span>
                     <span class="n">dataArray</span><span class="p">]</span>  <span class="c1"># The array was created with all elements as strings. Convert into floats.</span>
        <span class="n">dataArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataArray</span><span class="p">)</span>  <span class="c1"># convert to numpy array type</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot; does not exist!&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dataArray</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv1</span><span class="p">,</span> <span class="n">argv2</span><span class="p">,</span> <span class="n">argv3</span><span class="p">,</span> <span class="n">argv4</span><span class="p">,</span> <span class="n">argv5</span><span class="p">,</span> <span class="n">argv6</span><span class="p">,</span> <span class="n">argv7</span><span class="p">):</span>
    <span class="c1">## read the data into an array;</span>
    <span class="n">XSRV</span> <span class="o">=</span> <span class="n">read2array</span><span class="p">(</span><span class="n">argv1</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">XSRV</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s1">&#39;ndarray&#39;</span><span class="p">):</span>
        <span class="n">XSRV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">XSRV</span><span class="p">)</span>
    <span class="c1">##print array size</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">XSRV</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">XSRV</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">XSRV</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">XSRV</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">XSRV</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input data matrix size is :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cols</span><span class="p">))</span>

    <span class="n">tmpStr</span> <span class="o">=</span> <span class="n">argv2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">argv2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">argv2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">argv2</span><span class="p">)]</span>
    <span class="c1"># debugging</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">argv2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">argv2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">tmpStr</span> <span class="o">=</span> <span class="n">argv3</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">argv3</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">argv3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">argv3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">argv3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">argv3</span><span class="p">)</span>
    <span class="n">argv3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">argv3</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv3</span><span class="p">)))</span>

    <span class="n">tmpStr</span> <span class="o">=</span> <span class="n">argv4</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">argv4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">argv4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">argv4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">argv4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">argv4</span><span class="p">)</span>
    <span class="n">argv4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">argv4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv4</span><span class="p">)))</span>

    <span class="n">sampleSizes</span> <span class="o">=</span> <span class="n">argv3</span>  <span class="c1"># np.array([[1, 50, 100, 200, 250, 350, 500, 750, 1000]])</span>
    <span class="n">effectSizes</span> <span class="o">=</span> <span class="n">argv4</span>  <span class="c1"># np.array([[0.05, 0.1, 0.15,0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8]])</span>

    <span class="c1">##define output metric options</span>
    <span class="n">metric_opt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  <span class="c1"># see options description below</span>
    <span class="n">correction_opt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  <span class="c1"># see correction options description below</span>

    <span class="n">numberreps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">argv5</span><span class="p">)</span>

    <span class="n">outcome_type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">argv6</span><span class="p">)</span>

    <span class="n">cores</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">argv7</span><span class="p">)</span>

    <span class="c1">## ## Calculat for a subset of 4 variables (less than 20 seconds on 4-core desktop for each analysis)</span>
    <span class="n">diffgroups</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">linearregression</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">t_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">num_cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">argv2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">argv2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1">##if the number of variables is less than the request CPU cores, use number of variables as cores.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">num_cols</span> <span class="o">&lt;</span> <span class="n">cores</span><span class="p">):</span>
        <span class="n">cores</span> <span class="o">=</span> <span class="n">num_cols</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">num_cols</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">diffgroups</span><span class="p">,</span> <span class="n">output_uncTP_ratio_median</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_median</span><span class="p">,</span> <span class="n">output_bhTP_ratio_median</span><span class="p">,</span> <span class="n">output_byTP_ratio_median</span><span class="p">,</span> \
            <span class="n">output_uncTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_bhTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_byTP_ratio_iqr</span><span class="p">,</span> \
            <span class="n">output_uncTP</span><span class="p">,</span> <span class="n">output_bonfTP</span><span class="p">,</span> <span class="n">output_bhTP</span><span class="p">,</span> <span class="n">output_byTP</span> \
                <span class="o">=</span> <span class="n">PCalc_2Group</span><span class="p">(</span><span class="n">XSRV</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">argv2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">argv2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))],</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span>
                               <span class="n">numberreps</span><span class="p">,</span> <span class="n">cores</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">linearregression</span><span class="p">,</span> <span class="n">output_uncTP_ratio_median_ln</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_median_ln</span><span class="p">,</span> <span class="n">output_bhTP_ratio_median_ln</span><span class="p">,</span> <span class="n">output_byTP_ratio_median_ln</span><span class="p">,</span> \
            <span class="n">output_uncTP_ratio_iqr_ln</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_iqr_ln</span><span class="p">,</span> <span class="n">output_bhTP_ratio_iqr_ln</span><span class="p">,</span> <span class="n">output_byTP_ratio_iqr_ln</span><span class="p">,</span> \
                    <span class="n">output_uncTP</span><span class="p">,</span> <span class="n">output_bonfTP</span><span class="p">,</span> <span class="n">output_bhTP</span><span class="p">,</span> <span class="n">output_byTP</span> \
                        <span class="o">=</span> <span class="n">PCalc_Continuous</span><span class="p">(</span><span class="n">XSRV</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">argv2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">argv2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))],</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span>
                                   <span class="mi">5000</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">,</span> <span class="n">cores</span><span class="p">)</span>
        <span class="n">t_end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time elapsed: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t_end</span> <span class="o">-</span> <span class="n">t_start</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">t_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">diffgroups</span><span class="p">,</span> <span class="n">output_uncTP_ratio_median</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_median</span><span class="p">,</span> <span class="n">output_bhTP_ratio_median</span><span class="p">,</span> <span class="n">output_byTP_ratio_median</span><span class="p">,</span> \
            <span class="n">output_uncTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_bhTP_ratio_iqr</span><span class="p">,</span> <span class="n">output_byTP_ratio_iqr</span><span class="p">,</span> \
            <span class="n">output_uncTP</span><span class="p">,</span> <span class="n">output_bonfTP</span><span class="p">,</span> <span class="n">output_bhTP</span><span class="p">,</span> <span class="n">output_byTP</span> \
                <span class="o">=</span> <span class="n">PCalc_2Group</span><span class="p">(</span><span class="n">XSRV</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">,</span> <span class="n">cores</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">linearregression</span><span class="p">,</span> <span class="n">output_uncTP_ratio_median_ln</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_median_ln</span><span class="p">,</span> <span class="n">output_bhTP_ratio_median_ln</span><span class="p">,</span> <span class="n">output_byTP_ratio_median_ln</span><span class="p">,</span> \
            <span class="n">output_uncTP_ratio_iqr_ln</span><span class="p">,</span> <span class="n">output_bonfTP_ratio_iqr_ln</span><span class="p">,</span> <span class="n">output_bhTP_ratio_iqr_ln</span><span class="p">,</span> <span class="n">output_byTP_ratio_iqr_ln</span><span class="p">,</span> \
            <span class="n">output_uncTP</span><span class="p">,</span> <span class="n">output_bonfTP</span><span class="p">,</span> <span class="n">output_bhTP</span><span class="p">,</span> <span class="n">output_byTP</span> \
                <span class="o">=</span> <span class="n">PCalc_Continuous</span><span class="p">(</span><span class="n">XSRV</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">,</span> <span class="n">cores</span><span class="p">)</span>
        <span class="n">t_end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time elapsed: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t_end</span> <span class="o">-</span> <span class="n">t_start</span><span class="p">))</span>

    <span class="c1">##diffgroups has dimension of (number of variables, 4, 10, effectsize, samplesize);</span>
    <span class="c1">##number of variables is the input number of columns from the input dataset.</span>
    <span class="c1">##4-- 4 correction options</span>
    <span class="c1">##10--10 metric as &quot;TP&quot;,&quot;FP&quot;,&quot;TN&quot;,&quot;FN&quot;,&quot;FD&quot;,&quot;STP&quot;,&quot;SFP&quot;,&quot;STN&quot;,&quot;SFN&quot;,&quot;SFD&quot;</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Using the SurfacePlot function to visualize results </span>
<span class="sd">    SurfacePlot(output, variable,metric,correction, sizeeff,samplsizes,nreps)</span>
<span class="sd">    Output is the structure returned from the simulator, variable is the index of variable to plot</span>
<span class="sd">    metric is the to display and correction the type of multiple testing correction to </span>
<span class="sd">    visualize.</span>

<span class="sd">    Metric options:</span>
<span class="sd">    1 - True positive Rate</span>
<span class="sd">    2 - False Positive Rate</span>
<span class="sd">    3 - True Negative Rate</span>
<span class="sd">    4 - False Negative Rate</span>
<span class="sd">    Correction:</span>
<span class="sd">    1 - No correction</span>
<span class="sd">    2 - Bonferroni</span>
<span class="sd">    3 - Benjamini-Hochberg</span>
<span class="sd">    4 - Benjamini-Yekutieli</span>
<span class="sd">    The example line below will open the False Negative Rate surface for</span>
<span class="sd">    variable number 2 without multiple testing correction</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">##write diffgroups and linearregression into file for testing purpose</span>
    <span class="c1">##np.savetxt(&#39;diffgroups.csv&#39;,diffgroups[1][3][1], delimiter=&quot;,&quot;)</span>
    <span class="c1">##np.savetxt(&#39;linearregression.csv&#39;,linearregression[1][3][1], delimiter=&quot;,&quot;)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;papy_output&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;papy_output&#39;</span><span class="p">)</span>

    <span class="c1">##file names matrix</span>
    <span class="n">sv_filenames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s1">&#39;fpn&#39;</span><span class="p">,</span> <span class="s1">&#39;fpb&#39;</span><span class="p">,</span> <span class="s1">&#39;fpbh&#39;</span><span class="p">,</span> <span class="s1">&#39;fpby&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;tnn&#39;</span><span class="p">,</span> <span class="s1">&#39;tnb&#39;</span><span class="p">,</span> <span class="s1">&#39;tnbh&#39;</span><span class="p">,</span> <span class="s1">&#39;tnby&#39;</span><span class="p">],</span> \
                             <span class="p">[</span><span class="s1">&#39;fdn&#39;</span><span class="p">,</span> <span class="s1">&#39;fdb&#39;</span><span class="p">,</span> <span class="s1">&#39;fdbh&#39;</span><span class="p">,</span> <span class="s1">&#39;fdby&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;fnn&#39;</span><span class="p">,</span> <span class="s1">&#39;fnb&#39;</span><span class="p">,</span> <span class="s1">&#39;fnbh&#39;</span><span class="p">,</span> <span class="s1">&#39;fnby&#39;</span><span class="p">],</span> \
                             <span class="p">[</span><span class="s1">&#39;sfdn&#39;</span><span class="p">,</span> <span class="s1">&#39;sfdb&#39;</span><span class="p">,</span> <span class="s1">&#39;sfdbh&#39;</span><span class="p">,</span> <span class="s1">&#39;sfdby&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;stpn&#39;</span><span class="p">,</span> <span class="s1">&#39;stpb&#39;</span><span class="p">,</span> <span class="s1">&#39;stpbh&#39;</span><span class="p">,</span> <span class="s1">&#39;stpby&#39;</span><span class="p">],</span> \
                             <span class="p">[</span><span class="s1">&#39;stnn&#39;</span><span class="p">,</span> <span class="s1">&#39;stnb&#39;</span><span class="p">,</span> <span class="s1">&#39;stnbh&#39;</span><span class="p">,</span> <span class="s1">&#39;stnby&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;sfnn&#39;</span><span class="p">,</span> <span class="s1">&#39;sfnb&#39;</span><span class="p">,</span> <span class="s1">&#39;sfnbh&#39;</span><span class="p">,</span> <span class="s1">&#39;sfnby&#39;</span><span class="p">],</span> \
                             <span class="p">[</span><span class="s1">&#39;sfpn&#39;</span><span class="p">,</span> <span class="s1">&#39;sfpb&#39;</span><span class="p">,</span> <span class="s1">&#39;sfpbh&#39;</span><span class="p">,</span> <span class="s1">&#39;sfpby&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;tpn&#39;</span><span class="p">,</span> <span class="s1">&#39;tpb&#39;</span><span class="p">,</span> <span class="s1">&#39;tpbh&#39;</span><span class="p">,</span> <span class="s1">&#39;tpby&#39;</span><span class="p">]])</span>
    <span class="c1">##save the effect sizes and sample sizes</span>
    <span class="n">file_handle</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="s1">&#39;papy_output/effect_n_sample_sizes.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;effect sizes&#39;</span><span class="p">]),</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;sample sizes&#39;</span><span class="p">]),</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">file_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1">##save files. jj- Metric options; kk- Correction options; ii- Variable number; for example: jj=1, kk=1 mean tpn-- true positive no correction.</span>

    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sv_filenames</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sv_filenames</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># if (jj==2 and kk &gt; 0):</span>
            <span class="c1">#    break;</span>
            <span class="c1"># if (jj==4 and kk &gt; 0):</span>
            <span class="c1">#    break;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">file_handle</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="s1">&#39;papy_output/diffgroups-</span><span class="si">%s</span><span class="s1">.csv&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sv_filenames</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">kk</span><span class="p">]),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="c1">##write the title line with columns &quot;variables, Sample Sizes (Effect Sizes as columns), and Effect Sizes&quot;</span>
                <span class="n">title_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s1">&#39;Variables&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect Sizes (Sample Sizes in Columns)&#39;</span><span class="p">]]),</span>
                                      <span class="n">sampleSizes</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">title_str</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="c1">##write rest of output matrix</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">):</span>  <span class="c1">##num_cols is from the test dataset, means number of variables</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">diffgroups</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">kk</span><span class="p">][</span><span class="n">jj</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">effectSizes</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                                             <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                                                                                                 <span class="p">[</span><span class="n">effectSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                                                  <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                                                                             <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                               <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.5f</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">file_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">file_handle</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="s1">&#39;papy_output/linearregression-</span><span class="si">%s</span><span class="s1">.csv&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sv_filenames</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">kk</span><span class="p">]),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="c1">##write the title line with columns &quot;variables, Sample Sizes (Effect Sizes as columns), and Effect Sizes&quot;</span>
                <span class="n">title_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s1">&#39;Variables&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect Sizes (Sample Sizes in Columns)&#39;</span><span class="p">]]),</span>
                                      <span class="n">sampleSizes</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">title_str</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="c1">##write rest of matrix</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">):</span>  <span class="c1">##num_cols is from the test dataset, means number of variables</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">linearregression</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">kk</span><span class="p">][</span><span class="n">jj</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">effectSizes</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                                                   <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span>
                                                                                                               <span class="n">effectSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span>
                                                                                                                   <span class="mi">1</span><span class="p">],</span>
                                                                                                               <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span>
                                                                                                   <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                                      <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.5f</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">file_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="c1">##plot the surfaces of power rate acrossing the combination of effectSize and SampleSize (classfied)</span>
        <span class="n">iSurfacePlotTPR</span><span class="p">(</span><span class="n">output_uncTP_ratio_median</span><span class="p">,</span> <span class="s1">&#39;papy_output/plot-power-rate-noCorrection-diffgroups.html&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;no correction&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">)</span>
        <span class="n">iSurfacePlotTPR</span><span class="p">(</span><span class="n">output_bonfTP_ratio_median</span><span class="p">,</span> <span class="s1">&#39;papy_output/plot-power-rate-bonfCorrection-diffgroups.html&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Bonferroni correction&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">)</span>
        <span class="n">iSurfacePlotTPR</span><span class="p">(</span><span class="n">output_bhTP_ratio_median</span><span class="p">,</span> <span class="s1">&#39;papy_output/plot-power-rate-bhCorrection-diffgroups.html&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Benjamini-Hochberg correction&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">)</span>
        <span class="n">iSurfacePlotTPR</span><span class="p">(</span><span class="n">output_byTP_ratio_median</span><span class="p">,</span> <span class="s1">&#39;papy_output/plot-power-rate-byCorrection-diffgroups.html&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Benjamini-Yekutieli correction&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">)</span>

        <span class="c1">##plot the slice of surfaces power rate; x-axis is based on sample size (columns)</span>
        <span class="c1">## 2nd row, mid row, and the 2nd last row</span>
        <span class="n">slice_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">effectSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">effectSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_rows</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP_ratio_median</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP_ratio_iqr</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">sampleSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-noCorrection-diffgroups.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Sample Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpn&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect Size=&#39;</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">[:,</span> <span class="n">slice_rows</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_rows</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP_ratio_median</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP_ratio_iqr</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">sampleSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-bonfCorrection-diffgroups.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Sample Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpb&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect Size=&#39;</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">[:,</span> <span class="n">slice_rows</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_rows</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP_ratio_median</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP_ratio_iqr</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">sampleSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-bhCorrection-diffgroups.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Sample Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpbh&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect Size=&#39;</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">[:,</span> <span class="n">slice_rows</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_rows</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP_ratio_median</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP_ratio_iqr</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">sampleSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-byCorrection-diffgroups.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Sample Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpby&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect Size=&#39;</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">[:,</span> <span class="n">slice_rows</span><span class="p">])</span>

        <span class="c1">##plot the slice of surfaces power rate; x-axis is based on effect size (rows)</span>
        <span class="c1">## 2nd col, mid col, and the 2nd last col</span>
        <span class="n">slice_cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">sampleSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">sampleSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_cols</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP_ratio_median</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP_ratio_iqr</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">effectSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-noCorrection-diffgroups-eff.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Effect Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpn&#39;</span><span class="p">,</span> <span class="s1">&#39;Sample Size=&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">[:,</span> <span class="n">slice_cols</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_cols</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP_ratio_median</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP_ratio_iqr</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">effectSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-bonfCorrection-diffgroups-eff.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Effect Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpb&#39;</span><span class="p">,</span> <span class="s1">&#39;Sample Size=&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">[:,</span> <span class="n">slice_cols</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_cols</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP_ratio_median</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP_ratio_iqr</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">effectSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-bhCorrection-diffgroups-eff.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Effect Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpbh&#39;</span><span class="p">,</span> <span class="s1">&#39;Sample Size=&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">[:,</span> <span class="n">slice_cols</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_cols</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP_ratio_median</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP_ratio_iqr</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">effectSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-byCorrection-diffgroups-eff.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Effect Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpby&#39;</span><span class="p">,</span> <span class="s1">&#39;Sample Size=&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">[:,</span> <span class="n">slice_cols</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="c1">##plot the surfaces of power rate acrossing the combination of effectSize and SampleSize (linear regression)</span>
        <span class="n">iSurfacePlotTPR</span><span class="p">(</span><span class="n">output_uncTP_ratio_median_ln</span><span class="p">,</span> <span class="s1">&#39;papy_output/plot-power-rate-noCorrection-linearregression.html&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;no correction&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">)</span>
        <span class="n">iSurfacePlotTPR</span><span class="p">(</span><span class="n">output_bonfTP_ratio_median_ln</span><span class="p">,</span>
                        <span class="s1">&#39;papy_output/plot-power-rate-bonfCorrection-linearregression.html&#39;</span><span class="p">,</span> <span class="s1">&#39;Bonferroni correction&#39;</span><span class="p">,</span>
                        <span class="n">sampleSizes</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">)</span>
        <span class="n">iSurfacePlotTPR</span><span class="p">(</span><span class="n">output_bhTP_ratio_median_ln</span><span class="p">,</span> <span class="s1">&#39;papy_output/plot-power-rate-bhCorrection-linearregression.html&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Benjamini-Hochberg correction&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">)</span>
        <span class="n">iSurfacePlotTPR</span><span class="p">(</span><span class="n">output_byTP_ratio_median_ln</span><span class="p">,</span> <span class="s1">&#39;papy_output/plot-power-rate-byCorrection-linearregression.html&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;Benjamini-Yekutieli correction&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">)</span>

        <span class="c1">## (linear regression)</span>
        <span class="c1">##plot the slice of surfaces power rate; x-axis is based on sample size (columns)</span>
        <span class="c1">## 2nd row, mid row, and the 2nd last row</span>
        <span class="n">slice_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">effectSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">effectSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_rows</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP_ratio_median_ln</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP_ratio_iqr_ln</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">sampleSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-noCorrection-ln.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8 (linear-regression)&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Sample Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpn&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect Size=&#39;</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">[:,</span> <span class="n">slice_rows</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_rows</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP_ratio_median_ln</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP_ratio_iqr_ln</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">sampleSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-bonfCorrection-ln.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8 (linear-regression)&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Sample Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpb&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect Size=&#39;</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">[:,</span> <span class="n">slice_rows</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_rows</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP_ratio_median_ln</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP_ratio_iqr_ln</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">sampleSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-bhCorrection-ln.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8 (linear-regression)&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Sample Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpbh&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect Size=&#39;</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">[:,</span> <span class="n">slice_rows</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_rows</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP_ratio_median_ln</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP_ratio_iqr_ln</span><span class="p">[</span><span class="n">ll</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">sampleSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-byCorrection-ln.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8 (linear-regression)&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Sample Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpby&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect Size=&#39;</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">[:,</span> <span class="n">slice_rows</span><span class="p">])</span>

        <span class="c1">##plot the slice of surfaces power rate; x-axis is based on effect size (rows)</span>
        <span class="c1">## 2nd col, mid col, and the 2nd last col</span>
        <span class="n">slice_cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">sampleSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">sampleSizes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_cols</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP_ratio_median_ln</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_uncTP_ratio_iqr_ln</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">effectSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-noCorrection-ln-eff.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8 (linear-regression)&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Effect Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpn&#39;</span><span class="p">,</span> <span class="s1">&#39;Sample Size=&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">[:,</span> <span class="n">slice_cols</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_cols</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP_ratio_median_ln</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bonfTP_ratio_iqr_ln</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">effectSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-bonfCorrection-ln-eff.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8 (linear-regression)&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Effect Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpb&#39;</span><span class="p">,</span> <span class="s1">&#39;Sample Size=&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">[:,</span> <span class="n">slice_cols</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_cols</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP_ratio_median_ln</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_bhTP_ratio_iqr_ln</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">effectSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-bhCorrection-ln-eff.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8 (linear-regression)&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Effect Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpbh&#39;</span><span class="p">,</span> <span class="s1">&#39;Sample Size=&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">[:,</span> <span class="n">slice_cols</span><span class="p">])</span>

        <span class="n">Y_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Y_std_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">slice_cols</span><span class="p">:</span>
            <span class="n">Y_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP_ratio_median_ln</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
            <span class="n">Y_std_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_byTP_ratio_iqr_ln</span><span class="p">[:,</span> <span class="n">ll</span><span class="p">])</span>
        <span class="n">iSlicesPlot</span><span class="p">(</span><span class="n">effectSizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Y_temp</span><span class="p">,</span> <span class="n">Y_std_temp</span><span class="p">,</span> \
                    <span class="s1">&#39;papy_output/plot-slice-power-rate-byCorrection-ln-eff.html&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Proportion of Variables with Power (True Positive)&gt; 0.8 (linear-regression)&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;Effect Size&#39;</span><span class="p">,</span> <span class="s1">&#39;tpby&#39;</span><span class="p">,</span> <span class="s1">&#39;Sample Size=&#39;</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">[:,</span> <span class="n">slice_cols</span><span class="p">])</span>
        <span class="c1">##plot all surfac of True Positive</span>
        <span class="c1">## sv_name1=np.array([[&#39;tpn&#39;, &#39;tpb&#39;, &#39;tpbh&#39;, &#39;tpby&#39;]])</span>
        <span class="c1">## for ii in range(0, num_cols):</span>
        <span class="c1">## for jj in range(0, sv_name1.shape[1]):</span>
        <span class="c1">## ##print ii, jj, kk</span>
        <span class="c1">## iSurfacePlot(diffgroups, &#39;papy_output/plot-variable%d-diffgroups-%s.html&#39;%(ii+1,sv_name1[0][jj]), ii+1,  10, jj+1,sampleSizes, effectSizes,numberreps)</span>

    <span class="c1">##save and plot surface of mean of each variable;</span>
    <span class="c1">##sv_filenames.shape[0] is the dimension of metric options;</span>
    <span class="c1">##sv_filenames.shape[1] is the dimension of correction options</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sv_filenames</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sv_filenames</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># if (jj==2 and kk &gt; 0):</span>
            <span class="c1">#    break;</span>
            <span class="c1"># if (jj==4 and kk &gt; 0):</span>
            <span class="c1">#    break;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">temp_diffgroups_array</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">mean_diffgroups_array</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">temp_linearregression_array</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">mean_linearregression_array</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">temp_diffgroups_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diffgroups</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">kk</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">temp_linearregression_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linearregression</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">kk</span><span class="p">][</span><span class="n">jj</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">temp_diffgroups_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp_diffgroups_array</span><span class="p">)</span>
                <span class="n">mean_diffgroups_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp_diffgroups_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># for calculating standard deviation</span>
                <span class="n">std_diffgroups_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">temp_diffgroups_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">file_handle</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="s1">&#39;papy_output/mean-diffgroups-</span><span class="si">%s</span><span class="s1">.csv&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sv_filenames</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">kk</span><span class="p">]),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">mean_diffgroups_array</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.10f</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">file_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">temp_linearregression_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temp_linearregression_array</span><span class="p">)</span>
                <span class="n">mean_linearregression_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp_linearregression_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># for calculating standard deviation</span>
                <span class="n">std_linearregression_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">temp_linearregression_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">file_handle</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="s1">&#39;papy_output/mean-linearregression-</span><span class="si">%s</span><span class="s1">.csv&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sv_filenames</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">kk</span><span class="p">]),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">file_handle</span><span class="p">,</span> <span class="n">mean_linearregression_array</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.10f</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">file_handle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1">##plotting surface plots</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="n">mean_diffgroups_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">mean_diffgroups_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="n">mean_linearregression_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">mean_linearregression_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">iSurfacePlot</span><span class="p">(</span><span class="n">mean_diffgroups_array</span><span class="p">,</span> <span class="s1">&#39;papy_output/plot-mean-diffgroups-</span><span class="si">%s</span><span class="s1">.html&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sv_filenames</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">kk</span><span class="p">]),</span>
                             <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sampleSizes</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">iSurfacePlot</span><span class="p">(</span><span class="n">mean_linearregression_array</span><span class="p">,</span>
                             <span class="s1">&#39;papy_output/plot-mean-linearregression-</span><span class="si">%s</span><span class="s1">.html&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sv_filenames</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">kk</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="n">sampleSizes</span><span class="p">,</span> <span class="n">effectSizes</span><span class="p">,</span> <span class="n">numberreps</span><span class="p">)</span>

    <span class="c1">##copy plotSurface.py to papy_output folder</span>
    <span class="c1">##for plotting interactive surface plots for the variables separately</span>
    <span class="c1"># shutil.copy2(&#39;plotSurface.py&#39;,&#39;papy_output&#39;)</span>
    <span class="c1">##create a zip file on the output folder</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="s1">&#39;papy_output_zip&#39;</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="s1">&#39;papy_output&#39;</span><span class="p">)</span>

    <span class="c1">##copy some files for user viewing in results folder</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-power-rate-byCorrection-diffgroups.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-slice-power-rate-byCorrection-diffgroups.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-slice-power-rate-byCorrection-diffgroups-eff.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-power-rate-noCorrection-diffgroups.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-slice-power-rate-noCorrection-diffgroups.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-slice-power-rate-noCorrection-diffgroups-eff.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">outcome_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-power-rate-byCorrection-linearregression.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-slice-power-rate-byCorrection-ln.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-slice-power-rate-byCorrection-ln-eff.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-power-rate-noCorrection-linearregression.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-slice-power-rate-noCorrection-ln.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="s1">&#39;papy_output/plot-slice-power-rate-noCorrection-ln-eff.html&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
        <span class="c1">##delete the papy_output folder</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">&#39;papy_output&#39;</span><span class="p">)</span>

    <span class="c1">##display user information</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The output files are in the papy_output_zip.zip in the running directory&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please move the papy_output_zip.zip file to your work directory and unzipped it to view the output files.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a Python script, plotSurface.py, is included for plotting interactive surface plots for variables&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;for more details, please have a look the .zip file.&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1">##detect python version#</span>
    <span class="n">ver</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;2.7&#39;</span> <span class="ow">in</span> <span class="n">ver</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This tool currently only runs in Python 2.7. Please install Python 2.7&#39;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">##start to parse input arguments</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
    <span class="c1">## for i in range(1, len(args)):</span>
    <span class="c1">## print(args[i],type(args[i]),len(args[i]))</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;too few arguments&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;simple usage: python pa.py TutorialData.csv 8, TutorialData.csv is input test data set, can be replaced by </span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">              actual data set name, 8 means the first 8 variables, which can be a range, e.g., 8-16 </span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">              full usage: python pa.py TutorialData.csv 2-9 0:100:500 0.05:0.05:0.7 20 0 4 </span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">              0:100:500 (default value) means the range of sample sizes from 0 to 500 (not inclusive) with interval of 100 </span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">              0.05:0.05:0.7 (default value) means the range of effect sizes from 0.05 to 0.7 (not inclusive) with interval of 0.05 </span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">              20 is an integer number of repeats. Default value is 10. </span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">              0 is the default input for working for classification only. Please choose 1 to work on regression only or 2 to work on both. </span><span class="se">\n</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">              4 is an integer number as number of CPU cores to use. By default is to use all available cores. &#39;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">tmpStr</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The 3rd parameter is for defining the range of sample size with interval</span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                  for example, python pa.py TutorialData.csv 2-9 0:50:500&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0:100:501&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">tmpStr</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpStr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The 4th parameter is for defining the range of effect size with interval</span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                  for example, python pa.py TutorialData.csv 2-9 10:50:500 0.05:0.05:0.8&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0.05:0.05:0.8&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;10&#39;</span><span class="p">)</span>

        <span class="c1"># for calculating diffgroups, or linear regression or both</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">):</span>
        <span class="n">tmpInt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tmpInt</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tmpInt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Only work on classification (discrete)!&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tmpInt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Only work on regression (continuous)!&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tmpInt</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Work on both classification and regression!&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tmpInt</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tmpInt</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The 6th parameter is for dealing with outcome variables</span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                      please choose a number among 0, 1 and 2 </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                      0 - for work on classification outcome only </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                      1 - for work on regression outcome only </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                      2 - for work on both&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The 6th parameter is for dealing with outcome variables</span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                      please choose a number among 0, 1 and 2 </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                      0 - for work on classification outcome only </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                      1 - for work on regression outcome only </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                      2 - for work on both&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>

    <span class="c1"># for using number of cores of CPU</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">):</span>
        <span class="n">tmpInt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tmpInt</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cores</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cores</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">tmpInt</span> <span class="o">&gt;</span> <span class="n">cores</span><span class="p">:</span>
                    <span class="n">args</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cores</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Your machine does not have enough cores as you request, </span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                          the maximum number of cores - </span><span class="si">%i</span><span class="s1"> - will be used instead&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cores</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The 7th parameter is for defining the number of CPU cores to use</span><span class="se">\n</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">                  for example, python pa.py TutorialData.csv 2-9 10:50:500 0.05:0.05:0.8 10 4&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cores</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cores</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cores</span><span class="p">))</span>


        <span class="c1">## print(&#39;len of args is %i&#39;%(len(args[1:])))</span>
    <span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">papy</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jianlianggao&repo=papy&type=star&v=2&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pa.html">PAPY</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, J Gao.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    
    <a href="https://github.com/jianlianggao/papy" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>